!function(K){"use strict";K.fn.palleon=function(e){var h=K(this),a=document.body.clientWidth,d=K.extend({baseURL:"./",fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",fontSize:60,fontWeight:"normal",fontStyle:"normal",canvasColor:"transparent",fill:"#000",stroke:"#fff",strokeWidth:0,textBackgroundColor:"rgba(255,255,255,0)",textAlign:"left",lineHeight:1.2,borderColor:"#000",borderDashArray:[4,4],borderOpacityWhenMoving:.5,borderScaleFactor:2,editingBorderColor:"rgba(0,0,0,0.5)",cornerColor:"#fff",cornerSize:12,cornerStrokeColor:"#000",cornerStyle:"circle",transparentCorners:!1,cursorColor:"#000",cursorWidth:2,enableGLFiltering:!0,textureSize:4096,customFunctions:function(){},saveTemplate:function(){},saveImage:function(){}},e),t="",l="none",n="",i="",o="",r="",s=0,c=1,p=1,f="left",g="top",m="",u=[],b="",v="",y="",k="",w=0,x="add-to-canvas",C=["circle","square","rectangle","triangle","ellipse","trapezoid","emerald","star"],j=["square","rectangle","triangle"],I=[["Helvetica Neue","'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"],["Impact","Impact, Charcoal, sans-serif"],["Georgia","Georgia, serif"],["Palatino Linotype","'Palatino Linotype', 'Book Antiqua', Palatino, serif"],["Times New Roman","'Times New Roman', Times, serif"],["Arial","Arial, Helvetica, sans-serif"],["Arial Black","'Arial Black', Gadget, sans-serif"],["Comic Sans","'Comic Sans MS', cursive, sans-serif"],["Lucida Sans","'Lucida Sans Unicode', 'Lucida Grande', sans-serif"],["Tahoma","Tahoma, Geneva, sans-serif"],["Trebuchet","'Trebuchet MS', Helvetica, sans-serif"],["Verdana","Verdana, Geneva, sans-serif"],["Courier New","'Courier New', Courier, monospace"],["Lucida Console","'Lucida Console', Monaco, monospace"]];h.find(".crop-custom").css("display","none"),new FontFaceObserver("Material Icons").load(null,1e4).then(function(){K("#palleon").find("#palleon-main-loader").fadeOut(200)}).catch(function(e){console.log(e),K("#palleon").find("#palleon-main-loader").hide()});for(var A,e=new LazyLoad({callback_error:e=>{e.setAttribute("src",d.baseURL+"assets/placeholder.png"),K(e).parent().css("min-height","auto"),K(e).parent().find(".palleon-img-loader").remove()},callback_loaded:e=>{K(e).parent().css("min-height","auto"),K(e).parent().find(".palleon-img-loader").remove()}}),S=0;S<I.length;S++)h.find("#websafe-fonts").append(K('<option class="websafe-font"></option>').attr("value",I[S][1]).text(I[S][0]));function O(e){for(var a=e.split(","),e=a[0].match(/:(.*?);/)[1],t=atob(a[1]),l=t.length,n=new Uint8Array(l);l--;)n[l]=t.charCodeAt(l);return new Blob([n],{type:e})}function R(e,a){var t=new XMLHttpRequest;t.onload=function(){var e=new FileReader;e.onloadend=function(){a(e.result)},e.readAsDataURL(t.response)},t.open("GET",e),t.responseType="blob",t.send()}function P(){h.removeClass("panel-closed"),h.find(".palleon-icon-menu-btn").removeClass("active"),h.find("#palleon-icon-menu").removeClass("closed"),h.find("#palleon-toggle-left").removeClass("closed"),h.find("#palleon-toggle-left").find(".material-icons").html("chevron_left"),h.find("#palleon-icon-panel").show()}function T(){h.addClass("panel-closed"),h.find(".palleon-icon-menu-btn").removeClass("active"),h.find("#palleon-icon-menu").addClass("closed"),h.find("#palleon-toggle-left").addClass("closed"),h.find("#palleon-toggle-left").find(".material-icons").html("chevron_right"),h.find("#palleon-icon-panel").hide()}function F(e,a){""==e&&(e=(new Date).getTime()),""!=a&&"jpg"!=a||(a="jpeg"),h.find(".palleon-file-name").val(e),h.find(".palleon-file-name").data("default",e),h.find("#palleon-save-img-format").val(a),h.find("#palleon-save-img-format").trigger("change")}function q(e){var a,t;h.find("#palleon-canvas-loader").css("display","flex"),h.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),l=e,m.backgroundImage&&(u=m.backgroundImage.filters),"canvas"==l&&(h.find("#palleon-canvas-color").trigger("change"),t=document.createElement("canvas"),a=new fabric.Canvas(t),""==(e=parseInt(h.find("#palleon-canvas-width").val()))&&(e=800),""==(t=parseInt(h.find("#palleon-canvas-height").val()))&&(t=800),a.setWidth(e),a.setHeight(t),a.backgroundColor="transparent",t=O(a.toDataURL({format:"png",enableRetinaScaling:!1})),t=URL.createObjectURL(t),h.find("#palleon-canvas-img").attr("src",t),a.dispose()),h.find("#palleon-canvas-img-wrap").imagesLoaded(function(){n=h.find("#palleon-canvas-img")[0],i=h.find("#palleon-canvas-img").attr("src"),o=n.width,r=n.height,D(n),m.setDimensions({width:o,height:r}),fabric.Image.fromURL(i,function(e){m.setBackgroundImage(e,m.renderAll.bind(m),{objectType:"BG",mode:l,scaleX:c,scaleY:p,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})}),W(),X(),setTimeout(function(){s=0,p=c=1,f="left",g="top",h.find("#keep-data").is(":checked")?(m.backgroundImage.filters=u,m.backgroundImage.applyFilters()):(m.backgroundImage.filters=[],h.find("#palleon-adjust .conditional-settings").addClass("d-none"),h.find("#palleon-brightness").prop("checked",!1),h.find("#brightness").val(0),h.find("#palleon-contrast").prop("checked",!1),h.find("#contrast").val(0),h.find("#palleon-saturation").prop("checked",!1),h.find("#saturation").val(0),h.find("#palleon-hue").prop("checked",!1),h.find("#hue").val(0),h.find("#palleon-filters input[type=checkbox]").prop("checked",!1),h.find("#palleon-gamma").prop("checked",!1),h.find("#gamma-red").val(1),h.find("#gamma-green").val(1),h.find("#gamma-blue").val(1),h.find("#palleon-blend-color").prop("checked",!1),h.find("#blend-color-mode").val("add"),h.find("#blend-color-color").spectrum("set","#ffffff"),h.find("#blend-color-alpha").val(.5),h.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),h.find("#palleon-duotone-color").prop("checked",!1),h.find("#duotone-light-color").spectrum("set","green"),h.find("#duotone-dark-color").spectrum("set","blue"),h.find("#palleon-swap-colors").prop("checked",!1),h.find("#palleon-blur").prop("checked",!1),h.find("#blur").val(0),h.find("#palleon-noise").prop("checked",!1),h.find("#noise").val(0),h.find("#palleon-pixelate").prop("checked",!1),h.find("#pixelate").val(1),m.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>m.remove(e)),h.find("#palleon-layers li").remove(),M()),m.fire("selection:cleared"),m.requestRenderAll(),B('<span class="material-icons">flag</span>'+palleonParams.started)},100),h.find("#palleon-canvas-loader").hide()})}function X(){"none"==l?(h.find("#palleon-icon-menu, #palleon-icon-panel").css("pointer-events","none"),h.find(".palleon-keep").hide(),h.find("#modal-add-new").show(),h.find("#palleon-save").prop("disabled",!0)):(h.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),h.find("#palleon-icon-menu, #palleon-icon-panel").css("pointer-events","auto"),h.find(".palleon-keep").show(),h.find("#modal-add-new").hide(),h.find("#palleon-save").prop("disabled",!1)),"canvas"==l?(h.find("#palleon-resize-lock").removeClass("active"),h.find("#palleon-crop-lock").removeClass("active"),h.find(".hide-on-canvas-mode").hide()):(h.find("#palleon-resize-lock").addClass("active"),h.find("#palleon-crop-lock").addClass("active"),h.find(".hide-on-canvas-mode").show())}function Y(a){h.find("#palleon-canvas-loader").css("display","flex"),s=a.backgroundImage.angle,c=a.backgroundImage.scaleX,p=a.backgroundImage.scaleY,f=a.backgroundImage.originX,g=a.backgroundImage.originY,m.clear(),h.find("#palleon-layers li").remove(),l=a.backgroundImage.mode;var e=O(a.backgroundImage.src);i=URL.createObjectURL(e),h.find("#palleon-canvas-img").attr("src",i),o=a.backgroundImage.width,r=a.backgroundImage.height;for(var e={width:o,height:r},t=0;t<a.objects.length;t++)"textbox"==a.objects[t].objectType&&(a.objects[t].fontFamily=a.objects[t].fontFamily+"-palleon");m.loadFromJSON(a,function(){var e=m.getObjects().filter(e=>"textbox"==e.objectType);0!==(e=e).length&&K.each(e,function(e,a){var t=a.fontFamily.replace("-palleon","");a.fontFamily=d.fontFamily;var l,n,i,o,r="yes";if(""==t)r="no";else for(var s=0;s<I.length;s++)if(I[s][1]==t){r="no";break}"yes"==r?("undefined"!=typeof palleonCustomFonts&&palleonCustomFonts.fonts.includes(t)||WebFont.load({google:{families:[t+":regular,bold",t+":italic,regular,bold"]}}),l=new FontFaceObserver(t,{weight:"normal",style:"normal"}),n=new FontFaceObserver(t,{weight:"bold",style:"normal"}),i=new FontFaceObserver(t,{weight:"normal",style:"italic"}),o=new FontFaceObserver(t,{weight:"bold",style:"italic"}),Promise.all([l.load(null,5e3),n.load(null,5e3),i.load(null,5e3),o.load(null,5e3)]).then(function(){a.set("fontFamily",t),m.requestRenderAll()}).catch(function(e){console.log(e)})):(a.set("fontFamily",t),m.requestRenderAll())}),M(),m.requestRenderAll(),h.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),F((new Date).getTime(),""),D(e),W(),X(),m.fire("selection:cleared"),h.find("#palleon-canvas-color").spectrum("set",m.backgroundColor),h.find("#custom-image-background").spectrum("set",m.backgroundColor),setTimeout(function(){var e;h.find("#palleon-layers > li").removeClass("active"),e=a.backgroundImage.filters,h.find("#palleon-brightness").prop("checked",!1),h.find("#palleon-contrast").prop("checked",!1),h.find("#palleon-saturation").prop("checked",!1),h.find("#palleon-hue").prop("checked",!1),h.find("#grayscale").prop("checked",!1),h.find("#sepia").prop("checked",!1),h.find("#brownie").prop("checked",!1),h.find("#blackwhite").prop("checked",!1),h.find("#vintage").prop("checked",!1),h.find("#kodachrome").prop("checked",!1),h.find("#polaroid").prop("checked",!1),h.find("#technicolor").prop("checked",!1),h.find("#invert").prop("checked",!1),h.find("#sharpen").prop("checked",!1),h.find("#emboss").prop("checked",!1),h.find("#palleon-gamma").prop("checked",!1),h.find("#palleon-blend-color").prop("checked",!1),h.find("#palleon-duotone-color").prop("checked",!1),h.find("#palleon-blur").prop("checked",!1),h.find("#palleon-noise").prop("checked",!1),h.find("#palleon-pixelate").prop("checked",!1),0!==e.length&&K.each(e,function(e,a){"Brightness"==a.type?(h.find("#palleon-brightness").prop("checked",!0),h.find("#brightness").val(a.brightness),h.find("#brightness").parent().parent().find(".slider-label span").html(a.brightness)):"Contrast"==a.type?(h.find("#palleon-contrast").prop("checked",!0),h.find("#contrast").val(a.brightness),h.find("#contrast").parent().parent().find(".slider-label span").html(a.contrast)):"Saturation"==a.type?(h.find("#palleon-saturation").prop("checked",!0),h.find("#saturation").val(a.brightness),h.find("#saturation").parent().parent().find(".slider-label span").html(a.saturation)):"HueRotation"==a.type?(h.find("#palleon-hue").prop("checked",!0),h.find("#hue").val(a.rotation),h.find("#hue").parent().parent().find(".slider-label span").html(a.rotation)):"Grayscale"==a.type?h.find("#grayscale").prop("checked",!0):"Sepia"==a.type?h.find("#sepia").prop("checked",!0):"Brownie"==a.type?h.find("#brownie").prop("checked",!0):"BlackWhite"==a.type?h.find("#blackwhite").prop("checked",!0):"Vintage"==a.type?h.find("#vintage").prop("checked",!0):"Kodachrome"==a.type?h.find("#kodachrome").prop("checked",!0):"Polaroid"==a.type?h.find("#polaroid").prop("checked",!0):"Technicolor"==a.type?h.find("#technicolor").prop("checked",!0):"Invert"==a.type?h.find("#invert").prop("checked",!0):"Convolute"==a.type?"[0,-1,0,-1,5,-1,0,-1,0]"==a.matrix?h.find("#sharpen").prop("checked",!0):"[1,1,1,1,0.7,-1,-1,-1,-1]"==a.matrix?h.find("#emboss").prop("checked",!0):"[-1,0,1,-2,0,2,-1,0,1]"==a.matrix?h.find("#sobelX").prop("checked",!0):"[-1,-2,-1,0,0,0,1,2,1]"==a.matrix&&h.find("#sobelY").prop("checked",!0):"Gamma"==a.type?(h.find("#palleon-gamma").prop("checked",!0),h.find("#gamma-red").val(a.gamma[0]),h.find("#gamma-red").parent().parent().find(".slider-label span").html(a.gamma[0]),h.find("#gamma-green").val(a.gamma[1]),h.find("#gamma-green").parent().parent().find(".slider-label span").html(a.gamma[1]),h.find("#gamma-blue").val(a.gamma[2]),h.find("#gamma-blue").parent().parent().find(".slider-label span").html(a.gamma[2])):"BlendColor"==a.type?(h.find("#palleon-blend-color").prop("checked",!0),h.find("#blend-color-mode").val(a.mode),h.find("#blend-color-color").val(a.color),h.find("#blend-color-alpha").val(a.alpha),h.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(a.alpha)):"Composed"==a.type?(h.find("#palleon-duotone-color").prop("checked",!0),h.find("#duotone-light-color").val(a.subFilters[1].color),h.find("#duotone-dark-color").val(a.subFilters[2].color)):"Blur"==a.type?(h.find("#palleon-blur").prop("checked",!0),h.find("#blur").val(a.blur),h.find("#blur").parent().parent().find(".slider-label span").html(a.blur)):"Noise"==a.type?(h.find("#palleon-noise").prop("checked",!0),h.find("#noise").val(a.noise),h.find("#noise").parent().parent().find(".slider-label span").html(a.noise)):"Pixelate"==a.type&&(h.find("#palleon-pixelate").prop("checked",!0),h.find("#pixelate").val(a.blocksize),h.find("#pixelate").parent().parent().find(".slider-label span").html(a.blocksize))}),h.find("#palleon-brightness").trigger("change"),h.find("#palleon-contrast").trigger("change"),h.find("#palleon-saturation").trigger("change"),h.find("#palleon-hue").trigger("change"),h.find("#palleon-gamma").trigger("change"),h.find("#palleon-blend-color").trigger("change"),h.find("#palleon-blur").trigger("change"),h.find("#palleon-noise").trigger("change"),h.find("#palleon-pixelate").trigger("change")},100)}function z(e){var a=palleonParams.object,t="category";return null==e?(a=palleonParams.object,t="category"):"textbox"==e?(a=palleonParams.text,t="title"):"drawing"==e?(a=palleonParams.freeDrawing,t="brush"):"frame"==e?(a=palleonParams.frame,t="wallpaper"):"image"==e?(a=palleonParams.image,t="image"):"circle"==e?a=palleonParams.circle:"square"==e?a=palleonParams.square:"rectangle"==e?a=palleonParams.rectangle:"triangle"==e?a=palleonParams.triangle:"ellipse"==e?a=palleonParams.ellipse:"trapezoid"==e?a=palleonParams.trapezoid:"emerald"==e?a=palleonParams.emerald:"star"==e?a=palleonParams.star:"element"==e?(a=palleonParams.element,t="star"):"BG"==e?(a=palleonParams.bg,t="image"):"customSVG"==e&&(a=palleonParams.customSvg),'<span class="material-icons">'+t+"</span>"+a}function B(e){var a=h.find("#palleon-history-list"),t=new Date,l=String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0"),t=m.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);h.find("#palleon-history").prop("disabled",!1),a.find("li").removeClass("active"),a.prepend('<li class="active"><div class="info">'+e+'<span class="time">'+l+'</span></div><div><button type="button" class="palleon-btn primary"><span class="material-icons">restore</span>Restore</button><button type="button" class="palleon-btn danger"><span class="material-icons">clear</span>Delete</button><script type="text/json">'+JSON.stringify(t)+"<\/script></div></li>");t=a.find("li").length;a.data("max")<t&&a.find("li").last().remove(),h.find("#palleon-history-count").html(a.find("li").length);t=a.find("li.active").next("li"),a=a.find("li.active").prev("li");t.length?h.find("#palleon-undo").prop("disabled",!1):h.find("#palleon-undo").prop("disabled",!0),a.length?h.find("#palleon-redo").prop("disabled",!1):h.find("#palleon-redo").prop("disabled",!0)}K.getJSON(d.baseURL+"json/google-fonts.json",function(e){for(var a=0;a<e.items.length;a++)h.find("#google-fonts").append(K('<option class="google-font"></option>').attr("value",e.items[a].family).text(e.items[a].family))}),K.getJSON(d.baseURL+"json/material-icons.json",function(e){for(var a=0;a<e.categories.length;a++)for(var t=e.categories[a],l=0;l<t.icons.length;l++){var n=d.baseURL+"files/icons/"+t.icons[l].group_id+"/"+t.icons[l].ligature;h.find("#palleon-icons .palleon-grid").append('<div class="palleon-element add-element" data-elsource="'+n+'" data-loader="no" title="'+t.icons[l].name+'"><span class="material-icons">'+t.icons[l].ligature+"</div>")}}),h.find(".palleon-select.palleon-select2").select2({theme:"dark",width:"100%",templateSelection:J,templateResult:J,allowHtml:!0}),h.find(".palleon-colorpicker.disallow-empty").spectrum({allowEmpty:!1,showInitial:!0}),h.find(".palleon-colorpicker.allow-empty").spectrum({allowEmpty:!0,showInitial:!1}),toastr.options.closeButton=!0,toastr.options.positionClass="toast-bottom-left",toastr.options.progressBar=!0,toastr.options.newestOnTop=!0,toastr.options.showEasing="swing",toastr.options.hideEasing="linear",toastr.options.closeEasing="linear",h.find("#palleon-canvas-wrap").draggable({disabled:!0}),h.find(".paginated").each(function(){var e,a,t,l,n;e=K(this),t=e.find(">*"),l=t.length,(n=parseInt(e.data("perpage")))<l&&(t.slice(n).hide(),a='<div id="'+e.attr("id")+'-pagination" class="palleon-pagination"></div>',e.after(a),h.find("#"+e.attr("id")+"-pagination").pagination({items:l,itemsOnPage:n,prevText:'<span class="material-icons">navigate_before</span>',nextText:'<span class="material-icons">navigate_next</span>',displayedPages:3,onPageClick:function(e,a){void 0!==a&&a.preventDefault();a=n*(e-1),e=a+n;t.hide().slice(a,e).show()}}),h.find("#"+e.attr("id")+"-pagination").pagination("selectPage",1))}),h.find("#palleon-toggle-left").on("click",function(){(K(this).hasClass("closed")?P:T)()}),h.find("#palleon-toggle-right").on("click",function(){K(this).hasClass("closed")?(h.removeClass("layers-closed"),K(this).removeClass("closed"),K(this).find(".material-icons").html("chevron_right"),h.find("#palleon-right-col").show()):(h.addClass("layers-closed"),K(this).addClass("closed"),K(this).find(".material-icons").html("chevron_left"),h.find("#palleon-right-col").hide())}),h.find(".palleon-toggle-right").on("click",function(e){e.preventDefault(),h.find("#palleon-toggle-right").trigger("click")}),a<=1200&&(h.find("#palleon-toggle-right").trigger("click"),h.find("#palleon-toggle-left").trigger("click")),h.find(".palleon-icon-menu-btn").on("click",function(){K(this).data("target")&&(K(this).hasClass("active")?T():(P(),K(this).addClass("active"),h.find(".palleon-icon-panel-content").addClass("panel-hide"),h.find(K(this).data("target")).removeClass("panel-hide"))),"palleon-btn-elements"==K(this).attr("id")&&h.find("#palleon-all-elements-open").trigger("click")}),h.find(".palleon-dropdown-wrap").on("click",function(){K(this).hasClass("opened")?(K(this).removeClass("opened"),K(this).find(".palleon-dropdown").hide()):(K(this).addClass("opened"),K(this).find(".palleon-dropdown").show())}),h.find(".palleon-icon-panel-content ul.palleon-accordion > li > a").on("click",function(e){e.preventDefault();e=K(this).parent().parent();K(this).parent().hasClass("opened")?e.find("li").removeClass("opened"):(e.find("li").removeClass("opened"),K(this).parent().addClass("opened"))}),h.find(".palleon-lock-unlock").on("click",function(){K(this).hasClass("active")?(K(this).removeClass("active"),K(this).find(".material-icons").html("lock_open")):(K(this).addClass("active"),K(this).find(".material-icons").html("lock"))}),h.find(".palleon-slider").on("input",function(){K(this).parent().parent().find(".slider-label span").html(K(this).val()),h.find("span.tm-count-zoom").html(K(this).val())}),h.find('input[type="checkbox"]').on("change",function(){K(this).data("conditional")&&(K(this).is(":checked")?h.find(K(this).data("conditional")).removeClass("d-none"):h.find(K(this).data("conditional")).addClass("d-none"))}),h.find(".palleon-tabs-menu li").on("click",function(){var e=K(this).data("target"),a=K(this).parent().parent();a.find("> .palleon-tab").removeClass("active"),K(e).addClass("active"),a.find("> .palleon-tabs-menu li").removeClass("active"),K(this).addClass("active")}),h.find('input[type="number"],.numeric-field').bind("input paste keyup keydown",function(){this.value=this.value.replace(/(?!^-)[^0-9.]/g,"").replace(/(\..*)\./g,"$1"),K(this).data("max")&&this.value>K(this).data("max")&&(this.value=K(this).data("max")),K(this).data("min")&&this.value<K(this).data("min")&&(this.value=K(this).data("min"))}),h.find(".palleon-counter .counter-plus").on("click",function(){var e=K(this).parent().find("input.palleon-form-field"),a=parseInt(e.val())+parseInt(e.data("step"));e.data("max")&&a>e.data("max")&&(a=e.data("max")),e.data("min")&&a<e.data("min")&&(a=e.data("min")),a<0&&(a=0),e.val(a),"palleon-img-zoom-in"==K(this).attr("id")&&W(a)}),h.find(".palleon-counter .counter-minus").on("click",function(){var e=K(this).parent().find("input.palleon-form-field"),a=parseInt(e.val())-parseInt(e.data("step"));e.data("max")&&a>e.data("max")&&(a=e.data("max")),e.data("min")&&a<e.data("min")&&(a=e.data("min")),a<0&&(a=0),e.val(a),"palleon-img-zoom-out"==K(this).attr("id")&&W(a)}),fabric.enableGLFiltering=d.enableGLFiltering,fabric.textureSize=parseInt(d.textureSize),fabric.Object.prototype.borderColor=d.borderColor,fabric.Object.prototype.borderDashArray=d.borderDashArray,fabric.Object.prototype.borderOpacityWhenMoving=d.borderOpacityWhenMoving,fabric.Object.prototype.borderScaleFactor=d.borderScaleFactor,fabric.Object.prototype.editingBorderColor=d.editingBorderColor,fabric.Object.prototype.cornerColor=d.cornerColor,fabric.Object.prototype.cornerSize=d.cornerSize,fabric.Object.prototype.cornerStrokeColor=d.cornerStrokeColor,fabric.Object.prototype.cornerStyle=d.cornerStyle,fabric.Object.prototype.transparentCorners=d.transparentCorners,fabric.Object.prototype.cursorColor=d.cursorColor,fabric.Object.prototype.cursorWidth=d.cursorWidth,fabric.Object.prototype.strokeUniform=!0,fabric.Group.prototype.padding=0,fabric.Object.prototype.erasable=!1,fabric.Image.filters.Shift=fabric.util.createClass(fabric.Image.filters.ColorMatrix,{type:"Shift",matrix:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],mainParameter:!1,colorsOnly:!0}),t=h.find("#palleon-canvas")[0],(m=new fabric.Canvas(t)).backgroundColor=d.canvasColor,""!=h.find("#palleon-canvas-img").attr("src")&&(l="image",A=h.find("#palleon-canvas-img").data("filename"),t=h.find("#palleon-canvas-img").attr("src").match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""),F(A,t),q(l)),X(),""!=h.find("#palleon-canvas-img").data("template")&&(A=h.find("#palleon-canvas-img").data("filename"),h.find("#palleon-canvas-loader").css("display","flex"),h.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),h.find(".palleon-modal").hide(),m.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>m.remove(e)),h.find("#palleon-layers li").remove(),M(),K.getJSON(h.find("#palleon-canvas-img").data("template"),function(e){Y(e),setTimeout(function(){B('<span class="material-icons">flag</span>'+palleonParams.started),F(A,"")},100)}).fail(function(e,a,t){toastr.error("Request Failed: "+t,palleonParams.error)}).always(function(){h.find("#palleon-canvas-loader").hide()})),h.find(".palleon-modal-open").on("click",function(e){e.preventDefault();e=K(this).data("target");h.find(".palleon-modal").hide(),h.find(e).show()}),h.find(".palleon-modal-close").on("click",function(e){e.preventDefault();e=K(this).data("target");h.find(e).hide()}),h.find("#palleon-image-upload").on("change",function(){h.find(".palleon-modal").hide(),h.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible");var a=new FileReader;a.onload=function(e){h.find("#palleon-canvas-img").attr("src",a.result),q("image")},a.readAsDataURL(this.files[0]),F(this.files[0].name.replace(/\.[^/.]+$/,""),this.files[0].name.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""))}),h.find("#palleon-canvas-create").on("click",function(){F((new Date).getTime(),""),q("canvas")}),h.find("#palleon-template-search").on("click",function(){var e,a=h.find("#palleon-templates-menu").val(),t=K(this).parent().find("input");h.find("#palleon-all-templates-noimg").addClass("d-none"),h.find("#palleon-templates-grid .grid-item").each(function(){K(this).attr("data-keyword",K(this).data("keyword").toLowerCase())}),K(this).hasClass("cancel")?(h.find("#palleon-templates-menu").val("all").change(),h.find("#palleon-templates-menu").parent().find("span.select2-container").css("opacity",1),K(this).removeClass("cancel"),K(this).find(".material-icons").html("search"),K(this).removeClass("danger"),K(this).addClass("primary"),t.val(""),h.find("#palleon-templates-grid .grid-item").show(),h.find("#palleon-templates-grid-pagination").length&&(h.find("#palleon-templates-grid-pagination").pagination("redraw"),h.find("#palleon-templates-grid-pagination").pagination("selectPage",1)),t.prop("disabled",!1),h.find("#palleon-templates-menu").prop("disabled",!1)):(h.find("#palleon-templates-menu").parent().find("span.select2-container").css("opacity",.5),K(this).addClass("cancel"),K(this).find(".material-icons").html("close"),K(this).removeClass("primary"),K(this).addClass("danger"),(""==(e=t.val().toLowerCase().replace(/\s/g," "))||e.length<1)&&"all"==a?(h.find("#palleon-templates-grid .grid-item").show(),h.find("#palleon-templates-grid-pagination").length&&(h.find("#palleon-templates-grid-pagination").pagination("redraw"),h.find("#palleon-templates-grid-pagination").pagination("selectPage",1))):(h.find("#palleon-templates-grid-pagination").length&&h.find("#palleon-templates-grid-pagination").pagination("destroy"),"all"==a?(""!=e||1<e.length)&&h.find("#palleon-templates-grid .grid-item").hide().filter('[data-keyword*="'+e+'"]').show():(""!=e||1<e.length?h.find("#palleon-templates-grid .grid-item").hide().filter('[data-keyword*="'+e+'"]'):h.find("#palleon-templates-grid .grid-item").hide()).filter('[data-category*="'+a+'"]').show(),0===h.find("#palleon-templates-grid .grid-item:visible").length&&h.find("#palleon-all-templates-noimg").removeClass("d-none")),t.prop("disabled",!0),h.find("#palleon-templates-menu").prop("disabled",!0))}),h.find("#palleon-json-save").on("click",function(){var a=m.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);R(a.backgroundImage.src,function(e){a.backgroundImage.src=e;e=JSON.stringify(a);d.saveTemplate.call(this,h,e),h.find(".palleon-modal").hide()})}),h.find("#palleon-json-download").on("click",function(){var t=h.find("#palleon-json-download-name").val(),l=m.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);R(l.backgroundImage.src,function(e){l.backgroundImage.src=e;var a=JSON.stringify(l),e=document.createElement("a"),a=new Blob([a],{type:"text/plain"});e.href=URL.createObjectURL(a),e.download=t+".json",e.click(),h.find(".palleon-modal").hide()})}),h.find("#palleon-json-upload").on("change",function(e){h.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),h.find("#palleon-canvas-loader").css("display","flex");var a=new FileReader;a.onload=function(e){Y(JSON.parse(a.result)),h.find("#palleon-canvas-loader").hide(),setTimeout(function(){B('<span class="material-icons">flag</span>'+palleonParams.started)},100)},a.readAsText(e.target.files[0]),h.find(".palleon-modal").hide()}),h.find(".template-selection").on("click",".palleon-select-template",function(){h.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),h.find(".palleon-modal").hide(),h.find("#palleon-canvas-loader").css("display","flex"),m.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>m.remove(e)),h.find("#palleon-layers li").remove(),M(),K.getJSON(K(this).data("json"),function(e){Y(e),setTimeout(function(){B('<span class="material-icons">flag</span>'+palleonParams.started)},100)}).fail(function(e,a,t){toastr.error("Request Failed: "+t,palleonParams.error)}).always(function(){h.find("#palleon-canvas-loader").hide()})}),h.find("#palleon-my-templates-search").on("click",function(){var e,a=K(this).parent().find("input");h.find("#palleon-my-templates-noimg").addClass("d-none"),h.find("#palleon-my-templates li").each(function(){K(this).attr("data-keyword",K(this).data("keyword").toLowerCase())}),""!=a.val()&&(K(this).hasClass("cancel")?(K(this).removeClass("cancel"),K(this).find(".material-icons").html("search"),K(this).removeClass("danger"),K(this).addClass("primary"),a.val(""),h.find("#palleon-my-templates li").show(),h.find("#palleon-my-templates-pagination").length&&(h.find("#palleon-my-templates-pagination").pagination("redraw"),h.find("#palleon-my-templates-pagination").pagination("selectPage",1)),a.prop("disabled",!1)):(K(this).addClass("cancel"),K(this).find(".material-icons").html("close"),K(this).removeClass("primary"),K(this).addClass("danger"),e=a.val().toLowerCase().replace(/\s/g," "),console.log(e),""==e||e.length<1?(h.find("#palleon-my-templates li").show(),h.find("#palleon-my-templates-pagination").length&&(h.find("#palleon-my-templates-pagination").pagination("redraw"),h.find("#palleon-my-templates-pagination").pagination("selectPage",1))):(h.find("#palleon-my-templates-pagination").length&&h.find("#palleon-my-templates-pagination").pagination("destroy"),h.find("#palleon-my-templates li").hide().filter('[data-keyword*="'+e+'"]').show(),0===h.find("#palleon-my-templates li:visible").length&&h.find("#palleon-my-templates-noimg").removeClass("d-none")),a.prop("disabled",!0)))}),h.find("#palleon-download").on("click",function(){var e=h.find("#palleon-download-name").val(),a=parseFloat(h.find("#palleon-download-quality").val()),t=h.find("#palleon-download-format").val(),l=document.createElement("a");m.setZoom(1),h.find("#palleon-img-zoom").val(100);var n=r,i=o;0!=s&&180!=s&&-180!=s||(n=o,i=r),m.setWidth(n),m.setHeight(i);a=O(m.toDataURL({format:t,quality:a,enableRetinaScaling:!1})),a=URL.createObjectURL(a);l.download=e+"."+t,l.href=a,l.click(),W(),m.requestRenderAll(),h.find(".palleon-modal").hide()}),h.find("#palleon-download-format").on("change",function(){"png"==K(this).val()?h.find("#palleon-download-quality").prop("disabled",!0):h.find("#palleon-download-quality").prop("disabled",!1)}),h.find("#palleon-save-img-format").on("change",function(){"png"==K(this).val()?h.find("#palleon-save-img-quality").prop("disabled",!0):h.find("#palleon-save-img-quality").prop("disabled",!1)}),h.find("#palleon-canvas-size-select").on("change",function(){var e=K(this).val();"custom"==e?(h.find("#palleon-canvas-width").prop("disabled",!1),h.find("#palleon-canvas-height").prop("disabled",!1)):(h.find("#palleon-canvas-width").prop("disabled",!0),h.find("#palleon-canvas-height").prop("disabled",!0)),"blog-banner"==e?(h.find("#palleon-canvas-width").val(2240),h.find("#palleon-canvas-height").val(1260)):"fb-cover"==e?(h.find("#palleon-canvas-width").val(851),h.find("#palleon-canvas-height").val(315)):"fb-ad"==e?(h.find("#palleon-canvas-width").val(1200),h.find("#palleon-canvas-height").val(628)):"instagram"==e?(h.find("#palleon-canvas-width").val(1080),h.find("#palleon-canvas-height").val(1080)):"pinterest"==e?(h.find("#palleon-canvas-width").val(750),h.find("#palleon-canvas-height").val(1120)):"fb-post"==e?(h.find("#palleon-canvas-width").val(940),h.find("#palleon-canvas-height").val(788)):"twitter-post"==e?(h.find("#palleon-canvas-width").val(1600),h.find("#palleon-canvas-height").val(900)):"youtube"==e?(h.find("#palleon-canvas-width").val(1280),h.find("#palleon-canvas-height").val(720)):"wallpaper"==e&&(h.find("#palleon-canvas-width").val(1920),h.find("#palleon-canvas-height").val(1080))}),h.find("#palleon-canvas-color").on("change",function(){var e=K(this).val();h.find("#custom-image-background").spectrum("set",e),m.backgroundColor=""==e?"transparent":e,m.requestRenderAll()}),h.find("#palleon-media-library").on("click",function(){x="add-to-canvas"}),h.find("#palleon-img-media-library").on("click",function(){x="add-as-object"}),h.find("#palleon-img-replace-media-library").on("click",function(){x="replace-image"}),h.find("#modal-media-library").on("click",".media-library-grid>.palleon-masonry-item>.palleon-masonry-item-inner",function(){var e,a=K(this).find("img").data("full"),t=new Image;"add-to-canvas"==x?(e=a.substring(0,a.indexOf("?")),F(K(this).find("img").data("filename"),(""!=e?e:a).match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")),R(a,function(e){t.src=e,t.onload=function(){h.find("#palleon-canvas-img").attr("src",e),q("image")}})):"add-as-object"==x?(h.find("#palleon-canvas-loader").css("display","flex"),R(a,function(e){t.src=e,t.onload=function(){var e=new fabric.Image(t,{objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"});m.add(e),e.scaleToWidth(V()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(V()[1]/2),m.setActiveObject(e),m.requestRenderAll(),h.find("#palleon-canvas-loader").hide(),m.fire("palleon:history",{type:"image",text:palleonParams.added})}})):"replace-image"==x&&(h.find("#palleon-canvas-loader").css("display","flex"),R(a,function(e){t.src=e,t.onload=function(){m.getActiveObject().setSrc(e),m.requestRenderAll(),h.find("#palleon-canvas-loader").hide(),m.fire("palleon:history",{type:"image",text:palleonParams.replaced})}})),h.find("#modal-media-library").hide()}),h.find("#palleon-library-my-search").on("click",function(){var e,a=K(this).parent().find("input");h.find("#palleon-library-my-noimg").addClass("d-none"),""!=a.val()&&(K(this).hasClass("cancel")?(K(this).removeClass("cancel"),K(this).find(".material-icons").html("search"),K(this).removeClass("danger"),K(this).addClass("primary"),a.val(""),h.find("#palleon-library-my .palleon-masonry-item").show(),h.find("#palleon-library-my-pagination").length&&(h.find("#palleon-library-my-pagination").pagination("redraw"),h.find("#palleon-library-my-pagination").pagination("selectPage",1)),a.prop("disabled",!1)):(K(this).addClass("cancel"),K(this).find(".material-icons").html("close"),K(this).removeClass("primary"),K(this).addClass("danger"),""==(e=a.val().toLowerCase().replace(/\s/g," "))||e.length<1?(h.find("#palleon-library-my .palleon-masonry-item").show(),h.find("#palleon-library-my-pagination").length&&(h.find("#palleon-library-my-pagination").pagination("redraw"),h.find("#palleon-library-my-pagination").pagination("selectPage",1))):(h.find("#palleon-library-my-pagination").length&&h.find("#palleon-library-my-pagination").pagination("destroy"),h.find("#palleon-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+e+'"]').show(),0===h.find("#palleon-library-my .palleon-masonry-item:visible").length&&h.find("#palleon-library-my-noimg").removeClass("d-none")),a.prop("disabled",!0)))}),h.find("#palleon-library-all-search").on("click",function(){var e,a=K(this).parent().find("input");h.find("#palleon-library-all-noimg").addClass("d-none"),""!=a.val()&&(K(this).hasClass("cancel")?(K(this).removeClass("cancel"),K(this).find(".material-icons").html("search"),K(this).removeClass("danger"),K(this).addClass("primary"),a.val(""),h.find("#palleon-library-all .palleon-masonry-item").show(),h.find("#palleon-library-all-pagination").length&&(h.find("#palleon-library-all-pagination").pagination("redraw"),h.find("#palleon-library-all-pagination").pagination("selectPage",1)),a.prop("disabled",!1)):(K(this).addClass("cancel"),K(this).find(".material-icons").html("close"),K(this).removeClass("primary"),K(this).addClass("danger"),""==(e=a.val().toLowerCase().replace(/\s/g," "))||e.length<1?(h.find("#palleon-library-all .palleon-masonry-item").show(),h.find("#palleon-library-all-pagination").length&&(h.find("#palleon-library-all-pagination").pagination("redraw"),h.find("#palleon-library-all-pagination").pagination("selectPage",1))):(h.find("#palleon-library-all-pagination").length&&h.find("#palleon-library-all-pagination").pagination("destroy"),h.find("#palleon-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+e+'"]').show(),0===h.find("#palleon-library-all .palleon-masonry-item:visible").length&&h.find("#palleon-library-all-noimg").removeClass("d-none")),a.prop("disabled",!0)))}),h.find("#palleon-save-img").on("click",function(){var e=parseFloat(h.find("#palleon-save-img-quality").val()),a=h.find("#palleon-save-img-format").val();m.setZoom(1),h.find("#palleon-img-zoom").val(100);var t=r,l=o;0!=s&&180!=s&&-180!=s||(t=o,l=r),m.setWidth(t),m.setHeight(l);e=m.toDataURL({format:a,quality:e,enableRetinaScaling:!1});d.saveImage.call(this,h,e),h.find(".palleon-modal").hide(),W(),m.requestRenderAll()}),h.find(".svg-library-grid").on("click",">.palleon-masonry-item>.palleon-masonry-item-inner",function(){var e=K(this).find("img").data("full");fabric.loadSVGFromURL(e,function(e,a){a=fabric.util.groupSVGElements(e,a);a.set("originX","center"),a.set("originY","center"),a.set("left",V()[0]/2),a.set("top",V()[1]/2),a.set("objectType","customSVG"),a.scaleToWidth(V()[0]/2),a.scaleToHeight(V()[1]/2),m.add(a),m.setActiveObject(a),m.requestRenderAll()},function(){},{crossOrigin:"anonymous"}),h.find("#modal-svg-library").hide()}),h.find("#palleon-svg-library-my-search").on("click",function(){var e,a=K(this).parent().find("input");h.find("#palleon-svg-library-my-noimg").addClass("d-none"),""!=a.val()&&(K(this).hasClass("cancel")?(K(this).removeClass("cancel"),K(this).find(".material-icons").html("search"),K(this).removeClass("danger"),K(this).addClass("primary"),a.val(""),h.find("#palleon-svg-library-my .palleon-masonry-item").show(),h.find("#palleon-svg-library-my-pagination").length&&(h.find("#palleon-svg-library-my-pagination").pagination("redraw"),h.find("#palleon-svg-library-my-pagination").pagination("selectPage",1)),a.prop("disabled",!1)):(K(this).addClass("cancel"),K(this).find(".material-icons").html("close"),K(this).removeClass("primary"),K(this).addClass("danger"),""==(e=a.val().toLowerCase().replace(/\s/g," "))||e.length<1?(h.find("#palleon-svg-library-my .palleon-masonry-item").show(),h.find("#palleon-svg-library-my-pagination").length&&(h.find("#palleon-svg-library-my-pagination").pagination("redraw"),h.find("#palleon-svg-library-my-pagination").pagination("selectPage",1))):(h.find("#palleon-svg-library-my-pagination").length&&h.find("#palleon-svg-library-my-pagination").pagination("destroy"),h.find("#palleon-svg-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+e+'"]').show(),0===h.find("#palleon-svg-library-my .palleon-masonry-item:visible").length&&h.find("#palleon-svg-library-my-noimg").removeClass("d-none")),a.prop("disabled",!0)))}),h.find("#palleon-svg-library-all-search").on("click",function(){var e,a=K(this).parent().find("input");h.find("#palleon-library-all-noimg").addClass("d-none"),""!=a.val()&&(K(this).hasClass("cancel")?(K(this).removeClass("cancel"),K(this).find(".material-icons").html("search"),K(this).removeClass("danger"),K(this).addClass("primary"),a.val(""),h.find("#palleon-svg-library-all .palleon-masonry-item").show(),h.find("#palleon-svg-library-all-pagination").length&&(h.find("#palleon-svg-library-all-pagination").pagination("redraw"),h.find("#palleon-svg-library-all-pagination").pagination("selectPage",1)),a.prop("disabled",!1)):(K(this).addClass("cancel"),K(this).find(".material-icons").html("close"),K(this).removeClass("primary"),K(this).addClass("danger"),""==(e=a.val().toLowerCase().replace(/\s/g," "))||e.length<1?(h.find("#palleon-svg-library-all .palleon-masonry-item").show(),h.find("#palleon-svg-library-all-pagination").length&&(h.find("#palleon-svg-library-all-pagination").pagination("redraw"),h.find("#palleon-svg-library-all-pagination").pagination("selectPage",1))):(h.find("#palleon-svg-library-all-pagination").length&&h.find("#palleon-svg-library-all-pagination").pagination("destroy"),h.find("#palleon-svg-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+e+'"]').show(),0===h.find("#palleon-svg-library-all .palleon-masonry-item:visible").length&&h.find("#palleon-svg-library-all-noimg").removeClass("d-none")),a.prop("disabled",!0)))}),h.find("#palleon-undo").on("click",function(){var e=h.find("#palleon-history-list li.active").next("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),h.find("#palleon-redo").prop("disabled",!1)):h.find("#palleon-undo").prop("disabled",!0)}),h.find("#palleon-redo").on("click",function(){var e=h.find("#palleon-history-list li.active").prev("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),h.find("#palleon-undo").prop("disabled",!1)):h.find("#palleon-redo").prop("disabled",!0)}),h.find("#palleon-history-list").on("click",".palleon-btn.danger",function(){K(this).parent().parent().remove(),K("#palleon-history-list li").length||(h.find("#palleon-history").prop("disabled",!0),h.find("#palleon-undo").prop("disabled",!0),h.find("#palleon-redo").prop("disabled",!0),h.find(".palleon-modal").hide())}),h.find("#palleon-history-list").on("click",".palleon-btn.primary",function(){h.find("#palleon-history-list li").removeClass("active"),K(this).parent().parent().addClass("active");var e=h.find("#palleon-history-list li.active").next("li"),a=h.find("#palleon-history-list li.active").prev("li");e.length?h.find("#palleon-undo").prop("disabled",!1):h.find("#palleon-undo").prop("disabled",!0),a.length?h.find("#palleon-redo").prop("disabled",!1):h.find("#palleon-redo").prop("disabled",!0);var t=JSON.parse(K(this).parent().find("script").html());h.find(".palleon-modal").hide(),R(t.backgroundImage.src,function(e){t.backgroundImage.src=e,Y(t),h.find("#palleon-canvas-loader").hide()})}),h.find("#palleon-clear-history").on("click",function(){window.confirm("Are you sure you want clear the history?")&&(h.find("#palleon-history-list li").remove(),h.find("#palleon-history").prop("disabled",!0),h.find("#palleon-undo").prop("disabled",!0),h.find("#palleon-redo").prop("disabled",!0),h.find(".palleon-modal").hide())}),m.on("palleon:history",function(e){B(z(e.type)+" "+e.text)});var E=!1;function M(){h.find("#palleon-layers li").length?(h.find("#palleon-no-layer").hide(),h.find("#palleon-layer-delete-wrap").css("visibility","visible")):(h.find("#palleon-no-layer").show(),h.find("#palleon-layer-delete-wrap").css("visibility","hidden"))}function L(e){if(h.find("#palleon-layers li").removeClass("active"),2<=e.length)for(var a=0;a<e.length;a++)h.find("#palleon-layers #"+e[a].id).addClass("active");else(e=e[0]).objectType?("textbox"==e.objectType?(h.find("#palleon-text-settings").show(),l=e,h.find("#palleon-text-input").val(l.text),h.find("#palleon-font-family").val(l.fontFamily),h.find("#palleon-font-family").trigger("change"),"none"==l.gradientFill?(h.find("#palleon-text-gradient").val("none"),h.find("#palleon-text-color").spectrum("set",l.fill)):"vertical"==l.gradientFill?(h.find("#palleon-text-gradient").val("vertical"),4==l.fill.colorStops.length?(h.find("#text-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),h.find("#text-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),h.find("#text-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),h.find("#text-gradient-color-4").spectrum("set",l.fill.colorStops[3].color)):3==l.fill.colorStops.length?(h.find("#text-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),h.find("#text-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),h.find("#text-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),h.find("#text-gradient-color-4").spectrum("set","")):2==l.fill.colorStops.length&&(h.find("#text-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),h.find("#text-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),h.find("#text-gradient-color-3").spectrum("set",""),h.find("#text-gradient-color-4").spectrum("set",""))):"horizontal"==l.gradientFill&&(h.find("#palleon-text-gradient").val("horizontal"),4==l.fill.colorStops.length?(h.find("#text-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),h.find("#text-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),h.find("#text-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),h.find("#text-gradient-color-4").spectrum("set",l.fill.colorStops[3].color)):3==l.fill.colorStops.length?(h.find("#text-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),h.find("#text-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),h.find("#text-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),h.find("#text-gradient-color-4").spectrum("set","")):2==l.fill.colorStops.length&&(h.find("#text-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),h.find("#text-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),h.find("#text-gradient-color-3").spectrum("set",""),h.find("#text-gradient-color-4").spectrum("set",""))),h.find("#palleon-text-gradient").trigger("change"),"bold"==l.fontWeight?h.find("#format-bold").addClass("active"):h.find("#format-bold").removeClass("active"),"italic"==l.fontStyle?h.find("#format-italic").addClass("active"):h.find("#format-italic").removeClass("active"),1==l.underline?h.find("#format-underline").addClass("active"):h.find("#format-underline").removeClass("active"),"left"==l.textAlign&&(h.find(".format-align").removeClass("active"),h.find("#format-align-left").addClass("active")),"right"==l.textAlign&&(h.find(".format-align").removeClass("active"),h.find("#format-align-right").addClass("active")),"center"==l.textAlign&&(h.find(".format-align").removeClass("active"),h.find("#format-align-center").addClass("active")),"justify"==l.textAlign&&(h.find(".format-align").removeClass("active"),h.find("#format-align-justify").addClass("active")),h.find("#palleon-font-size").val(l.fontSize),h.find("#palleon-outline-size").val(l.strokeWidth),h.find("#palleon-line-height").val(l.lineHeight),h.find("#palleon-letter-spacing").val(l.charSpacing),h.find("#palleon-outline-color").spectrum("set",l.stroke),h.find("#palleon-text-background").spectrum("set",l.textBackgroundColor),null==l.shadow?h.find("#palleon-text-shadow").prop("checked",!1):(h.find("#palleon-text-shadow").prop("checked",!0),h.find("#text-shadow-color").spectrum("set",l.shadow.color),h.find("#text-shadow-blur").val(l.shadow.blur),h.find("#text-shadow-offset-x").val(l.shadow.offsetX),h.find("#text-shadow-offset-y").val(l.shadow.offsetY)),h.find("#palleon-text-shadow").trigger("change"),1==l.flipX?h.find("#text-flip-x").addClass("active"):h.find("#text-flip-x").removeClass("active"),1==l.flipY?h.find("#text-flip-y").addClass("active"):h.find("#text-flip-y").removeClass("active"),h.find("#text-skew-x").val(l.skewX),h.find("#text-skew-x").parent().parent().find(".slider-label span").html(l.skewX),h.find("#text-skew-y").val(l.skewY),h.find("#text-skew-y").parent().parent().find(".slider-label span").html(l.skewY),h.find("#text-rotate").val(parseInt(l.angle)),h.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(l.angle)),h.find("#palleon-btn-text").hasClass("active")||h.find("#palleon-btn-text").trigger("click"),h.find("#palleon-font-family").trigger("change")):h.find("#palleon-text-settings").hide(),"image"==e.objectType?(h.find("#palleon-image-settings").show(),l=e,h.find("#img-border-radius").val(l.roundedCorders),h.find("#img-border-radius").parent().parent().find(".slider-label span").html(l.roundedCorders),null==l.shadow?h.find("#palleon-image-shadow").prop("checked",!1):(h.find("#palleon-image-shadow").prop("checked",!0),h.find("#image-shadow-color").spectrum("set",l.shadow.color),h.find("#image-shadow-blur").val(l.shadow.blur),h.find("#image-shadow-offset-x").val(l.shadow.offsetX),h.find("#image-shadow-offset-y").val(l.shadow.offsetY)),h.find("#palleon-image-shadow").trigger("change"),h.find("#img-border-width").val(l.strokeWidth),h.find("#img-border-color").spectrum("set",l.stroke),h.find("#img-opacity").val(l.opacity),h.find("#img-opacity").parent().parent().find(".slider-label span").html(l.opacity),h.find("#img-skew-x").val(l.skewX),h.find("#img-skew-x").parent().parent().find(".slider-label span").html(l.skewX),h.find("#img-skew-y").val(l.skewY),h.find("#img-skew-y").parent().parent().find(".slider-label span").html(l.skewY),h.find("#img-rotate").val(parseInt(l.angle)),h.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(l.angle)),h.find("#palleon-btn-image").hasClass("active")||h.find("#palleon-btn-image").trigger("click")):h.find("#palleon-image-settings").hide(),"frame"==e.objectType&&(h.find("#palleon-btn-frames").hasClass("active")||h.find("#palleon-btn-frames").trigger("click")),"element"==e.objectType||"customSVG"==e.objectType?(h.find("#palleon-custom-element-options").show(),h.find("#palleon-custom-element-options-info").hide(),"none"==(t=e).gradientFill?(h.find("#palleon-element-gradient").val("none"),h.find("#palleon-element-color").spectrum("set",t.fill)):"vertical"==t.gradientFill?(h.find("#palleon-element-gradient").val("vertical"),4==t.fill.colorStops.length?(h.find("#element-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#element-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#element-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#element-gradient-color-4").spectrum("set",t.fill.colorStops[3].color)):3==t.fill.colorStops.length?(h.find("#element-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#element-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#element-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#element-gradient-color-4").spectrum("set","")):2==t.fill.colorStops.length&&(h.find("#element-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#element-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#element-gradient-color-3").spectrum("set",""),h.find("#element-gradient-color-4").spectrum("set",""))):"horizontal"==t.gradientFill&&(h.find("#palleon-element-gradient").val("horizontal"),4==t.fill.colorStops.length?(h.find("#element-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#element-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#element-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#element-gradient-color-4").spectrum("set",t.fill.colorStops[3].color)):3==t.fill.colorStops.length?(h.find("#element-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#element-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#element-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#element-gradient-color-4").spectrum("set","")):2==t.fill.colorStops.length&&(h.find("#element-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#element-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#element-gradient-color-3").spectrum("set",""),h.find("#element-gradient-color-4").spectrum("set",""))),h.find("#palleon-element-gradient").trigger("change"),h.find("#element-opacity").val(t.opacity),h.find("#element-opacity").parent().parent().find(".slider-label span").html(t.opacity),h.find("#element-skew-x").val(t.skewX),h.find("#element-skew-x").parent().parent().find(".slider-label span").html(t.skewX),h.find("#element-skew-y").val(t.skewX),h.find("#element-skew-y").parent().parent().find(".slider-label span").html(t.skewY),h.find("#element-rotate").val(parseInt(t.angle)),h.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(t.angle)),null==t.shadow?h.find("#palleon-element-shadow").prop("checked",!1):(h.find("#palleon-element-shadow").prop("checked",!0),h.find("#element-shadow-color").spectrum("set",t.shadow.color),h.find("#element-shadow-blur").val(t.shadow.blur),h.find("#element-shadow-offset-x").val(t.shadow.offsetX),h.find("#element-shadow-offset-y").val(t.shadow.offsetY)),h.find("#palleon-element-shadow").trigger("change"),h.find("#palleon-btn-elements").hasClass("active")||h.find("#palleon-btn-elements").trigger("click"),h.find("#palleon-custom-element-open").trigger("click")):(h.find("#palleon-custom-element-options").hide(),h.find("#palleon-custom-element-options-info").show()),C.includes(e.objectType)?(j.includes(e.objectType)?h.find("#shape-custom-width-wrap").show():h.find("#shape-custom-width-wrap").hide(),h.find("#palleon-shape-settings").show(),t=e,h.find("#shape-outline-width").val(t.strokeWidth),"none"==t.gradientFill?(h.find("#palleon-shape-gradient").val("none"),h.find("#palleon-shape-color").spectrum("set",t.fill)):"vertical"==t.gradientFill?(h.find("#palleon-shape-gradient").val("vertical"),4==t.fill.colorStops.length?(h.find("#shape-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#shape-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#shape-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#shape-gradient-color-4").spectrum("set",t.fill.colorStops[3].color)):3==t.fill.colorStops.length?(h.find("#shape-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#shape-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#shape-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#shape-gradient-color-4").spectrum("set","")):2==t.fill.colorStops.length&&(h.find("#shape-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#shape-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#shape-gradient-color-3").spectrum("set",""),h.find("#shape-gradient-color-4").spectrum("set",""))):"horizontal"==t.gradientFill&&(h.find("#palleon-shape-gradient").val("horizontal"),4==t.fill.colorStops.length?(h.find("#shape-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#shape-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#shape-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#shape-gradient-color-4").spectrum("set",t.fill.colorStops[3].color)):3==t.fill.colorStops.length?(h.find("#shape-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#shape-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#shape-gradient-color-3").spectrum("set",t.fill.colorStops[2].color),h.find("#shape-gradient-color-4").spectrum("set","")):2==t.fill.colorStops.length&&(h.find("#shape-gradient-color-1").spectrum("set",t.fill.colorStops[0].color),h.find("#shape-gradient-color-2").spectrum("set",t.fill.colorStops[1].color),h.find("#shape-gradient-color-3").spectrum("set",""),h.find("#shape-gradient-color-4").spectrum("set",""))),h.find("#palleon-shape-gradient").trigger("change"),h.find("#shape-outline-color").spectrum("set",t.stroke),null==t.shadow?h.find("#palleon-shape-shadow").prop("checked",!1):(h.find("#palleon-shape-shadow").prop("checked",!0),h.find("#shape-shadow-color").spectrum("set",t.shadow.color),h.find("#shape-shadow-blur").val(t.shadow.blur),h.find("#shape-shadow-offset-x").val(t.shadow.offsetX),h.find("#shape-shadow-offset-y").val(t.shadow.offsetY)),h.find("#palleon-shape-shadow").trigger("change"),h.find("#shape-opacity").val(t.opacity),h.find("#shape-opacity").parent().parent().find(".slider-label span").html(t.opacity),h.find("#shape-skew-x").val(t.skewX),h.find("#shape-skew-x").parent().parent().find(".slider-label span").html(t.skewX),h.find("#shape-skew-y").val(t.skewX),h.find("#shape-skew-y").parent().parent().find(".slider-label span").html(t.skewY),h.find("#shape-rotate").val(parseInt(t.angle)),h.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(t.angle)),h.find("#shape-custom-width").val(""),h.find("#shape-custom-height").val(""),h.find("#palleon-btn-shapes").hasClass("active")||h.find("#palleon-btn-shapes").trigger("click")):h.find("#palleon-shape-settings").hide(),e.id&&h.find("#palleon-layers #"+e.id).addClass("active")):K.each(e,function(e,a){h.find("#palleon-layers #"+a.id).addClass("active")});var t,l}function G(){fabric.Image.fromURL(i,function(e){m.setBackgroundImage(e,m.renderAll.bind(m),{objectType:"BG",mode:l,top:0,left:0,scaleX:c,scaleY:p,selectable:!1,angle:s,originX:f,originY:g,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})})}function W(e){var a,t,l=r,n=o;0!=s&&180!=s&&-180!=s||(l=o,n=r),e?(e/=100,m.setZoom(e)):(a=h.find("#palleon-img-zoom").val(),t=1,e=0,l<h.find("#palleon-content").width()&&n<h.find("#palleon-content").height()?(m.setZoom(1),h.find("#palleon-img-zoom").val(100)):(l>h.find("#palleon-content").width()&&100*(t=(h.find("#palleon-content").width()-60)/l).toFixed(2)<a&&(m.setZoom(t.toFixed(2)),h.find("#palleon-img-zoom").val(100*t.toFixed(2)),e=t.toFixed(2)),n>h.find("#palleon-content").height()&&100*(t=h.find("#palleon-content").height()/n).toFixed(2)<a&&(0===e||e>t.toFixed(2))&&(m.setZoom(t.toFixed(2)),h.find("#palleon-img-zoom").val(100*t.toFixed(2))))),m.setWidth(l*m.getZoom()),m.setHeight(n*m.getZoom()),!0===m.isDrawingMode&&(h.find("#palleon-erase-btn").hasClass("active")&&h.find("#eraser-width").trigger("input"),h.find("#palleon-draw-btn").hasClass("active")&&h.find("#brush-width").trigger("input"))}m.on("object:moving",function(e){E=!0}),m.on("mouse:up",function(e){e=e.target;null!==e&&(e=e.objectType,E&&B(z(e)+" "+palleonParams.moved))}),m.on("object:moving",function(e){var a=r,t=o;0!=s&&180!=s&&-180!=s||(a=o,t=r);var l=e.target,n=l.getScaledWidth(),e=l.getScaledHeight();l.isPartiallyOnScreen()&&"clipPath"==l.objectType&&(l.top<0&&l.left<0?(l.top=0,l.left=0,l.lockMovementX=!0,l.lockMovementY=!0):l.top<0&&n+l.left>a?(l.top=0,l.left=a-n,l.lockMovementX=!0,l.lockMovementY=!0):e+l.top>t&&l.left<0?(l.top=t-e,l.left=0,l.lockMovementX=!0,l.lockMovementY=!0):e+l.top>t&&n+l.left>a?(l.top=t-e,l.left=a-n,l.lockMovementX=!0,l.lockMovementY=!0):l.top<0?(l.top=0,l.lockMovementY=!0):l.left<0?(l.left=0,l.lockMovementX=!0):n+l.left>a?(l.left=a-n,l.lockMovementX=!0):e+l.top>t&&(l.top=t-e,l.lockMovementY=!0),l.setCoords())}),m.on("object:scaling",function(e){var a=r,t=o;0!=s&&180!=s&&-180!=s||(a=o,t=r);var l=e.target,n=l.getScaledWidth(),e=l.getScaledHeight();l.isPartiallyOnScreen()&&"clipPath"==l.objectType&&(a<=n&&(l.set({scaleX:a/l.width}),l.lockScalingX=!0),t<=e&&(l.set({scaleY:t/l.height}),l.lockScalingY=!0),l.top<0&&(l.top=0,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()),l.left<0&&(l.left=0,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()),n+l.left>a&&(l.left=a-n,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()),e+l.top>t&&(l.top=t-e,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()))}),m.on("object:added",function(e){var a,t,l,n,i,o,r,s,d,c,p,f,g=e.target;"clipPath"!=g.objectType&&"drawing"!=g.objectType&&(!0===m.isDrawingMode?(g.set("objectType","drawing"),g.set("selectable",!1),g.set("lockMovementX",!0),g.set("lockMovementY",!0),g.set("lockRotation",!0)):(a=m.getObjects().indexOf(g),r="",t="Object",l="category",n="layer-visible",i="visibility",o="layer-unlocked",e="lock_open",0==g.visible&&(n="layer-hidden",i="visibility_off"),0==g.selectable&&(o="layer-locked",e="lock"),g.set("id",(new Date).getTime()),h.find("#palleon-layers > li").removeClass("active"),"textbox"==g.objectType?(t=g.text,l="title"):"drawing"==g.objectType?(t=palleonParams.freeDrawing,l="brush"):"frame"==g.objectType?(t=palleonParams.frame,l="wallpaper"):"image"==g.objectType?(t=palleonParams.image,l="image"):"circle"==g.objectType?t=palleonParams.circle:"square"==g.objectType?t=palleonParams.square:"rectangle"==g.objectType?t=palleonParams.rectangle:"triangle"==g.objectType?t=palleonParams.triangle:"ellipse"==g.objectType?t=palleonParams.ellipse:"trapezoid"==g.objectType?t=palleonParams.trapezoid:"emerald"==g.objectType?t=palleonParams.emerald:"star"==g.objectType?t=palleonParams.star:"element"==g.objectType?(t=palleonParams.element,l="star"):"customSVG"==g.objectType&&(t=palleonParams.customSvg),"layerName"in g&&(t=g.layerName),r='<li id="'+g.id+'" data-type="'+g.objectType+'" class="layer-'+g.objectType+' active" data-sort="'+a+'"><span class="material-icons">'+l+'</span><input class="layer-name" autocomplete="off" value="'+t+'" /><span class="material-icons layer-settings">settings</span><div class="layer-icons"><a class="material-icons lock-layer '+o+'" title="'+palleonParams.lockunlock+'">'+e+'</a><a class="material-icons text-success duplicate-layer" title="'+palleonParams.duplicate+'">content_copy</a><a class="material-icons layer-visibility '+n+'" title="'+palleonParams.showhide+'">'+i+'</a><a class="material-icons text-danger delete-layer" title="'+palleonParams.delete+'">clear</a></div></li>',h.find("#palleon-layers").prepend(r),p=g.id,(f=h.find("#palleon-layers #"+p)).find("a.delete-layer").on("click",function(e){e.preventDefault(),m.getObjects().filter(e=>e.id==p).forEach(e=>m.remove(e)),f.remove(),m.requestRenderAll(),h.find("#palleon-layers").sortable("refresh"),M(),m.fire("palleon:history",{type:f.data("type"),text:palleonParams.removed})}),d=g.id,(c=h.find("#palleon-layers #"+d)).find("a.duplicate-layer").on("click",function(e){e.preventDefault(),m.getObjects().filter(e=>e.id==d).forEach(a=>a.clone(function(e){e.set("id",(new Date).getTime()),e.set("objectType",a.objectType),m.add(e),m.setActiveObject(e)})),m.requestRenderAll(),h.find("#palleon-layers").sortable("refresh"),m.fire("palleon:history",{type:c.data("type"),text:palleonParams.added})}),s=g.id,h.find("#palleon-layers #"+s).find("a.layer-visibility").on("click",function(e){e.preventDefault();e=m.getObjects();K(this).hasClass("layer-visible")?(K(this).removeClass("layer-visible"),K(this).addClass("layer-hidden"),K(this).html("visibility_off"),e.filter(e=>e.id==s).forEach(e=>e.set("visible",!1))):K(this).hasClass("layer-hidden")&&(K(this).removeClass("layer-hidden"),K(this).addClass("layer-visible"),K(this).html("visibility"),e.filter(e=>e.id==s).forEach(e=>e.set("visible",!0))),m.requestRenderAll()}),r=g.id,h.find("#palleon-layers #"+r).find("a.lock-layer").on("click",function(e){e.preventDefault();e=m.getActiveObject();K(this).hasClass("layer-unlocked")?(K(this).removeClass("layer-unlocked"),K(this).addClass("layer-locked"),K(this).html("lock"),e.set({lockMovementX:!0,lockMovementY:!0,lockRotation:!0,selectable:!1})):K(this).hasClass("layer-locked")&&(K(this).removeClass("layer-locked"),K(this).addClass("layer-unlocked"),K(this).html("lock_open"),e.set({lockMovementX:!1,lockMovementY:!1,lockRotation:!1,selectable:!0})),m.requestRenderAll()}),r=g.id,h.find("#palleon-layers #"+r).on("click",function(e){var a=m.getObjects(),t=K(this).attr("id");a.filter(e=>e.id==t).forEach(e=>m.setActiveObject(e)),h.find("#palleon-layers > li").removeClass("active"),K(this).addClass("active"),m.requestRenderAll()}),g=g.id,h.find("#palleon-layers #"+g).find(".layer-name").on("change",function(e){var a=m.getObjects(),t=K(this).parent("li").attr("id");a.filter(e=>e.id==t).forEach(e=>e.set({layerName:K(this).val()}))}),h.find("#palleon-layers").sortable("refresh"),M()))}),m.on("object:modified",function(e){e=e.target;"textbox"==e.objectType&&e.id&&(h.find("#palleon-layers #"+e.id+" .layer-name").html(e.text),h.find("#text-rotate").val(parseInt(m.getActiveObject().angle)),h.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(m.getActiveObject().angle))),"image"==e.objectType&&e.id&&(h.find("#img-rotate").val(parseInt(m.getActiveObject().angle)),h.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(m.getActiveObject().angle))),"element"!=e.objectType&&"customSVG"!=e.objectType||!e.id||(h.find("#element-rotate").val(parseInt(m.getActiveObject().angle)),h.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(m.getActiveObject().angle))),C.includes(e.objectType)&&e.id&&(h.find("#shape-rotate").val(parseInt(m.getActiveObject().angle)),h.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(m.getActiveObject().angle))),"clipPath"==e.objectType&&(e.lockScalingX=!1,e.lockScalingY=!1,e.lockMovementX=!1,e.lockMovementY=!1)}),h.find(".palleon-horizontal-center").on("click",function(){var e=m.getActiveObject();e.set("originX","center"),e.set("left",V()[0]/2),m.requestRenderAll()}),h.find(".palleon-vertical-center").on("click",function(){var e=m.getActiveObject();e.set("originY","center"),e.set("top",V()[1]/2),m.requestRenderAll()}),m.on("selection:created",function(e){L(e.selected)}),m.on("selection:updated",function(e){L(e.selected),h.find("#palleon-font-family").trigger("change")}),m.on("selection:cleared",function(){h.find("#palleon-text-settings").hide(),h.find("#palleon-image-settings").hide(),h.find("#palleon-shape-settings").hide(),h.find("#palleon-custom-element-options").hide(),h.find("#palleon-custom-element-options-info").show(),h.find("#palleon-layers > li").removeClass("active")}),h.find("#palleon-layers").sortable({placeholder:"layer-placeholder",axis:"y",update:function(e,a){var l=m.getObjects();K("#palleon-layers li").each(function(a,t){K(this).attr("data-sort",a+1),l.filter(e=>e.id==t.id).forEach(e=>e.moveTo(-(a+1)))}),m.requestRenderAll()},create:function(e,a){M()}}).disableSelection(),h.find("#palleon-layers").on("click",".layer-settings",function(){var e=K(this).next();K(this).hasClass("active")?(K(this).removeClass("active"),e.hide()):(h.find("#palleon-layers .layer-icons").hide(),h.find("#palleon-layers .layer-settings").removeClass("active"),K(this).addClass("active"),e.show())}),h.find("#palleon-layer-delete").on("click",function(){var a,e;window.confirm("Are you sure you want to delete the layers?")&&(a=h.find("#palleon-layer-select").val(),e=m.getObjects(),"all"==a?(e.forEach(e=>m.remove(e)),h.find("#palleon-layers > li").remove()):(e.filter(e=>e.objectType==a).forEach(e=>m.remove(e)),h.find("#palleon-layers > li.layer-"+a).remove()),m.requestRenderAll(),h.find("#palleon-layers").sortable("refresh"),M())}),h.find("#palleon-img-drag").on("click",function(){K(this).hasClass("active")?(K(this).removeClass("active"),h.find("#palleon-canvas-overlay").hide(),h.find("#palleon-canvas-wrap").draggable("disable")):(K(this).addClass("active"),h.find("#palleon-canvas-overlay").show(),h.find("#palleon-canvas-wrap").draggable("enable"))}),h.find(".palleon-counter input.palleon-form-field").on("input",function(){W(parseInt(K(this).val()))});var D=function(e){h.find("#palleon-resize-width").val(Math.round(e.width)),h.find("#palleon-resize-height").val(Math.round(e.height)),h.find("#palleon-img-width").html(Math.round(e.width)),h.find("#palleon-img-height").html(Math.round(e.height)),h.find("#palleon-crop-width").val(Math.round(e.width/2)),h.find("#palleon-crop-height").val(Math.round(e.height/2)),"image"==l?(h.find("#palleon-resize-width").data("max",Math.round(e.width)),h.find("#palleon-resize-height").data("max",Math.round(e.height)),h.find("#palleon-crop-width").data("max",Math.round(e.width)),h.find("#palleon-crop-height").data("max",Math.round(e.height))):(h.find("#palleon-resize-width").data("max",""),h.find("#palleon-resize-height").data("max",""))};function U(){var e=m.getObjects();e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!1)),m.backgroundColor="transparent";var a=O(m.toDataURL({format:"png",enableRetinaScaling:!1}));i=URL.createObjectURL(a),h.find("#palleon-canvas-img").attr("src",i),m.backgroundColor=h.find("#custom-image-background").val(),e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!0))}function _(){var e=m.getObjects();b.moveTo(9999),m.setActiveObject(b),h.find("#palleon-crop-btns").removeClass("disabled"),h.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","none"),h.find(".palleon-icon-panel-content ul.palleon-accordion > li.accordion-crop").css("pointer-events","auto"),e.filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType).forEach(e=>e.set("selectable",!1))}function H(e){p=0==s||180==s||-180==s?(m.setDimensions({width:r,height:o}),c=m.height/n.width,m.width/n.height):(m.setDimensions({width:o,height:r}),c=m.width/n.width,m.height/n.height),"right"==e?0==s?(s=90,f="left",g="bottom"):90==s?(s=180,f="right",g="bottom"):180==s?(s=270,f="right",g="top"):270==s||-90==s?(s=0,f="left",g="top"):-180==s?(s=-90,f="right",g="top"):-270==s&&(s=-180,f="right",g="bottom"):"left"==e&&(0==s?(s=-90,f="right",g="top"):-90==s?(s=-180,f="right",g="bottom"):-180==s?(s=-270,f="left",g="bottom"):-270==s||90==s?(s=0,f="left",g="top"):180==s?(s=90,f="left",g="bottom"):270==s&&(s=180,f="right",g="bottom")),m.backgroundImage.set({scaleX:c,scaleY:p,angle:s,originX:f,originY:g}),D(m),W(),m.requestRenderAll(),m.fire("palleon:history",{type:"BG",text:palleonParams.rotated})}h.find("#palleon-crop-style").on("change",function(){var e,a;""!=K(this).val()&&K(this).select2("enable",!1),"freeform"==K(this).val()?((b=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:o/2,height:r/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1})},m.add(b),_()):"custom"==K(this).val()?(h.find(".crop-custom").css("display","flex"),e=parseInt(h.find("#palleon-crop-width").val()),a=parseInt(h.find("#palleon-crop-height").val()),(b=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:e,height:a,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})},m.add(b),_()):"square"==K(this).val()?(a=r<=o?o/2:r/2,(b=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:a,height:a,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},m.add(b),_()):"original"==K(this).val()?((b=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:o/2,height:r/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},m.add(b),_()):(m.getObjects().filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType&&"drawing"!=e.objectType).forEach(e=>e.set("selectable",!0)),h.find(".crop-custom").css("display","none"),h.find("#palleon-crop-btns").addClass("disabled"),h.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","auto"))}),h.find("#palleon-crop-cancel").on("click",function(){h.find("#palleon-crop-btns").addClass("disabled"),h.find("#palleon-crop-style").select2("enable"),h.find("#palleon-crop-style").val(""),h.find("#palleon-crop-style").trigger("change"),m.remove(""),m.remove(b)}),h.find("#palleon-crop-apply").on("click",function(){var e;window.confirm("Are you sure you want to crop the image?")&&(h.find("#palleon-crop-btns").addClass("disabled"),h.find("#palleon-crop-style").select2("enable"),h.find("#palleon-crop-style").val(""),h.find("#palleon-crop-style").trigger("change"),m.setZoom(1),h.find("#palleon-img-zoom").val(100),e=b.getBoundingRect(),m.setWidth(e.width-1),m.setHeight(e.height-1),m.backgroundImage.set({top:-e.top,left:-e.left}),m.remove(""),m.remove(b),U(),h.find("#palleon-canvas-img-wrap").imagesLoaded(function(){o=m.width,r=m.height,s=0,f="left",g="top",p=c=1,G(),D(m),W(),m.requestRenderAll()}))}),h.find("#palleon-crop-width").bind("input paste",function(){var e;h.find("#palleon-crop-lock").hasClass("active")&&(e=K(this).data("max")/h.find("#palleon-crop-height").data("max"),h.find("#palleon-crop-height").val(Math.round(this.value/e))),b.set("width",parseInt(K(this).val())),b.set("height",parseInt(h.find("#palleon-crop-height").val())),m.requestRenderAll()}),h.find("#palleon-crop-height").bind("input paste",function(){var e;h.find("#palleon-crop-lock").hasClass("active")&&(e=K(this).data("max")/h.find("#palleon-crop-width").data("max"),h.find("#palleon-crop-width").val(Math.round(this.value/e))),b.set("height",parseInt(K(this).val())),b.set("width",parseInt(h.find("#palleon-crop-width").val())),m.requestRenderAll()}),h.find("#palleon-resize-apply").on("click",function(){var e,a;window.confirm("Are you sure you want to resize the image?")&&(e=parseInt(h.find("#palleon-resize-width").val()),a=parseInt(h.find("#palleon-resize-height").val()),o=e,r=a,m.setZoom(1),h.find("#palleon-img-zoom").val(100),m.setWidth(e),m.setHeight(a),p=0==s||180==s||-180==s?(c=m.width/h.find("#palleon-canvas-img")[0].width,m.height/h.find("#palleon-canvas-img")[0].height):(c=m.height/h.find("#palleon-canvas-img")[0].width,m.width/h.find("#palleon-canvas-img")[0].height),m.backgroundImage.set({scaleX:c,scaleY:p}),U(),h.find("#palleon-canvas-img-wrap").imagesLoaded(function(){o=m.width,r=m.height,s=0,f="left",g="top",p=c=1,G(),D(m),W(),m.requestRenderAll()}))}),h.find("#palleon-resize-width").bind("input paste",function(){var e;h.find("#palleon-resize-lock").hasClass("active")&&(e=K(this).data("max")/h.find("#palleon-resize-height").data("max"),h.find("#palleon-resize-height").val(Math.round(this.value/e)))}),h.find("#palleon-resize-height").bind("input paste",function(){var e;h.find("#palleon-resize-lock").hasClass("active")&&(e=K(this).data("max")/h.find("#palleon-resize-width").data("max"),h.find("#palleon-resize-width").val(Math.round(this.value/e)))}),h.find("#palleon-rotate-right").on("click",function(){H("right")}),h.find("#palleon-rotate-left").on("click",function(){H("left")}),h.find("#palleon-flip-horizontal").on("click",function(){m.backgroundImage.toggle("flipX"),m.requestRenderAll(),m.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),h.find("#palleon-flip-vertical").on("click",function(){m.backgroundImage.toggle("flipY"),m.requestRenderAll(),m.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),h.find("#palleon-brightness").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.Brightness):(h.find("#brightness").val(0),h.find("#brightness").parent().parent().find(".slider-label span").html(0),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Brightness"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#brightness").on("input",function(){m.backgroundImage.filters.filter(e=>"Brightness"==e.type).forEach(e=>e.brightness=parseFloat(this.value)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#brightness").on("change",function(e){e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-contrast").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.Contrast):(h.find("#contrast").val(0),h.find("#contrast").parent().parent().find(".slider-label span").html(0),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Contrast"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#contrast").on("input",function(){m.backgroundImage.filters.filter(e=>"Contrast"==e.type).forEach(e=>e.contrast=parseFloat(this.value)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#contrast").on("change",function(e){e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-saturation").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.Saturation):(h.find("#saturation").val(0),h.find("#saturation").parent().parent().find(".slider-label span").html(0),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Saturation"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#saturation").on("input",function(){m.backgroundImage.filters.filter(e=>"Saturation"==e.type).forEach(e=>e.saturation=parseFloat(this.value)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#saturation").on("change",function(e){e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-hue").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.HueRotation):(h.find("#hue").val(0),h.find("#hue").parent().parent().find(".slider-label span").html(0),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"HueRotation"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#hue").on("input",function(){m.backgroundImage.filters.filter(e=>"HueRotation"==e.type).forEach(e=>e.rotation=parseFloat(this.value)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#hue").on("change",function(e){e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-filters input[type=checkbox]").on("change",function(e){K(this).is(":checked")?"grayscale"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Grayscale):"sepia"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Sepia):"blackwhite"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.BlackWhite):"brownie"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Brownie):"vintage"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Vintage):"kodachrome"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Kodachrome):"technicolor"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Technicolor):"polaroid"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Polaroid):"shift"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Shift):"invert"==K(this).attr("id")?m.backgroundImage.filters.push(new fabric.Image.filters.Invert):"sharpen"==K(this).attr("id")?(h.find("#emboss").prop("checked",!1),h.find("#sobelX").prop("checked",!1),h.find("#sobelY").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type),m.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}))):"emboss"==K(this).attr("id")?(h.find("#sharpen").prop("checked",!1),h.find("#sobelX").prop("checked",!1),h.find("#sobelY").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type),m.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}))):"sobelX"==K(this).attr("id")?(h.find("#emboss").prop("checked",!1),h.find("#sharpen").prop("checked",!1),h.find("#sobelY").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type),m.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,0,1,-2,0,2,-1,0,1]}))):"sobelY"==K(this).attr("id")&&(h.find("#emboss").prop("checked",!1),h.find("#sharpen").prop("checked",!1),h.find("#sobelX").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type),m.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,-2,-1,0,0,0,1,2,1]}))):"grayscale"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Grayscale"!=e.type):"sepia"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Sepia"!=e.type):"blackwhite"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"BlackWhite"!=e.type):"brownie"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Brownie"!=e.type):"vintage"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Vintage"!=e.type):"kodachrome"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Kodachrome"!=e.type):"technicolor"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Technicolor"!=e.type):"polaroid"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Polaroid"!=e.type):"shift"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Shift"!=e.type):"invert"==K(this).attr("id")?m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Invert"!=e.type):"sharpen"==K(this).attr("id")?(h.find("#emboss").prop("checked",!1),h.find("#sobelX").prop("checked",!1),h.find("#sobelY").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"emboss"==K(this).attr("id")?(h.find("#sharpen").prop("checked",!1),h.find("#sobelX").prop("checked",!1),h.find("#sobelY").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelX"==K(this).attr("id")?(h.find("#emboss").prop("checked",!1),h.find("#sharpen").prop("checked",!1),h.find("#sobelY").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelY"==K(this).attr("id")&&(h.find("#emboss").prop("checked",!1),h.find("#sharpen").prop("checked",!1),h.find("#sobelX").prop("checked",!1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Convolute"!=e.type)),m.backgroundImage.applyFilters(),m.requestRenderAll(),e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-gamma").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.Gamma):(h.find("#gamma-red").val(1),h.find("#gamma-red").parent().parent().find(".slider-label span").html(1),h.find("#gamma-green").val(1),h.find("#gamma-green").parent().parent().find(".slider-label span").html(1),h.find("#gamma-blue").val(1),h.find("#gamma-blue").parent().parent().find(".slider-label span").html(1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Gamma"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#palleon-gamma-settings input").on("input",function(){var a=[parseFloat(K("#gamma-red").val()),parseFloat(K("#gamma-green").val()),parseFloat(K("#gamma-blue").val())];m.backgroundImage.filters.filter(e=>"Gamma"==e.type).forEach(e=>e.gamma=a),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#palleon-gamma-settings input").on("change",function(e){e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-blur").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.Blur):(h.find("#blur").val(0),h.find("#blur").parent().parent().find(".slider-label span").html(0),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Blur"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#blur").on("change",function(e){m.backgroundImage.filters.filter(e=>"Blur"==e.type).forEach(e=>e.blur=parseFloat(this.value)),m.backgroundImage.applyFilters(),m.requestRenderAll(),e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-noise").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.Noise):(h.find("#noise").val(0),h.find("#noise").parent().parent().find(".slider-label span").html(0),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Noise"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#noise").on("input",function(){m.backgroundImage.filters.filter(e=>"Noise"==e.type).forEach(e=>e.noise=parseInt(this.value,10)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#noise").on("change",function(e){e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-pixelate").on("change",function(){K(this).is(":checked")?m.backgroundImage.filters.push(new fabric.Image.filters.Pixelate):(h.find("#pixelate").val(1),h.find("#pixelate").parent().parent().find(".slider-label span").html(1),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Pixelate"!=e.type),m.backgroundImage.applyFilters()),m.requestRenderAll()}),h.find("#pixelate").on("change",function(e){m.backgroundImage.filters.filter(e=>"Pixelate"==e.type).forEach(e=>e.blocksize=parseInt(this.value,10)),m.backgroundImage.applyFilters(),m.requestRenderAll(),e.originalEvent&&B(palleonParams.bg+" "+palleonParams.edited)}),h.find("#palleon-blend-color").on("change",function(){var a,t,l;K(this).is(":checked")?(a=h.find("#blend-color-mode").val(),t=h.find("#blend-color-color").val(),l=parseFloat(h.find("#blend-color-alpha").val()),m.backgroundImage.filters.push(new fabric.Image.filters.BlendColor),m.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=a,e=>e.color=t,e=>e.alpha=parseFloat(l))):(h.find("#blend-color-mode").val("add"),h.find("#blend-color-color").spectrum("set","#ffffff"),h.find("#blend-color-alpha").val(.5),h.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"BlendColor"!=e.type)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#blend-color-mode").on("change",function(){m.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=this.value),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#blend-color-color").on("change",function(){m.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.color=this.value),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#blend-color-alpha").on("input",function(){m.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.alpha=parseFloat(this.value)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#palleon-duotone-color").on("change",function(){K(this).is(":checked")?(k=new fabric.Image.filters.Composed({subFilters:[new fabric.Image.filters.Grayscale({mode:"luminosity"}),new fabric.Image.filters.BlendColor({color:h.find("#duotone-light-color").val()}),new fabric.Image.filters.BlendColor({color:h.find("#duotone-dark-color").val(),mode:"lighten"})]}),m.backgroundImage.filters.push(k)):(h.find("#duotone-light-color").spectrum("set","green"),h.find("#duotone-dark-color").spectrum("set","blue"),m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Composed"!=e.type)),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#duotone-light-color").on("change",function(){m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Composed"!=e.type),m.backgroundImage.filters.push(k),k.subFilters[1].color=K(this).val(),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#duotone-dark-color").on("change",function(){m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"Composed"!=e.type),m.backgroundImage.filters.push(k),k.subFilters[2].color=K(this).val(),m.backgroundImage.applyFilters(),m.requestRenderAll()}),h.find("#palleon-swap-apply").on("click",function(){var e=new fabric.Image.filters.SwapColor({colorSource:h.find("#color-source").val(),colorDestination:h.find("#color-destination").val()});m.backgroundImage.filters.push(e),m.backgroundImage.applyFilters(),m.requestRenderAll(),K(this).prop("disabled",!0),h.find("#palleon-swap-remove").prop("disabled",!1)}),h.find("#palleon-swap-remove").on("click",function(){m.backgroundImage.filters=m.backgroundImage.filters.filter(e=>"SwapColor"!=e.type),m.backgroundImage.applyFilters(),m.requestRenderAll(),K(this).prop("disabled",!0),h.find("#palleon-swap-apply").prop("disabled",!1)}),h.find("#palleon-swap-colors").on("change",function(){K(this).is(":checked")||h.find("#palleon-swap-remove").trigger("click")});function N(e){var a=m.getActiveObject(),t=0;a.set("gradientFill",h.find("#palleon-"+e+"-gradient").val());var l="";if(""==h.find("#"+e+"-gradient-color-3").val()&&""==h.find("#"+e+"-gradient-color-4").val()?l=[{offset:0,color:h.find("#"+e+"-gradient-color-1").val()},{offset:1,color:h.find("#"+e+"-gradient-color-2").val()}]:""!=h.find("#"+e+"-gradient-color-3").val()&&""==h.find("#"+e+"-gradient-color-4").val()?l=[{offset:0,color:h.find("#"+e+"-gradient-color-1").val()},{offset:.5,color:h.find("#"+e+"-gradient-color-2").val()},{offset:1,color:h.find("#"+e+"-gradient-color-3").val()}]:""!=h.find("#"+e+"-gradient-color-1").val()&&""!=h.find("#"+e+"-gradient-color-2").val()&&""!=h.find("#"+e+"-gradient-color-3").val()&&""!=h.find("#"+e+"-gradient-color-4").val()&&(l=[{offset:0,color:h.find("#"+e+"-gradient-color-1").val()},{offset:.25,color:h.find("#"+e+"-gradient-color-2").val()},{offset:.75,color:h.find("#"+e+"-gradient-color-3").val()},{offset:1,color:h.find("#"+e+"-gradient-color-4").val()}]),"vertical"==h.find("#palleon-"+e+"-gradient").val()){if(h.find("#"+e+"-gradient-settings").show(),h.find("#"+e+"-fill-color").hide(),a.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:l})),("element"==a.objectType||"customSVG"==a.objectType)&&a._objects)for(t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:l})})}else if("horizontal"==h.find("#palleon-"+e+"-gradient").val()){if(h.find("#"+e+"-gradient-settings").show(),h.find("#"+e+"-fill-color").hide(),a.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:l})),("element"==a.objectType||"customSVG"==a.objectType)&&a._objects)for(t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:l})})}else if(h.find("#"+e+"-gradient-settings").hide(),h.find("#"+e+"-fill-color").show(),a.set("fill",h.find("#palleon-"+e+"-color").val()),("element"==a.objectType||"customSVG"==a.objectType)&&a._objects)for(t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set("fill",h.find("#palleon-"+e+"-color").val());m.requestRenderAll()}K.each(["text","image","shape","element","customSVG"],function(e,a){h.find("#palleon-"+a+"-shadow").on("change",function(){var e=new fabric.Shadow({color:h.find("#"+a+"-shadow-color").val(),blur:h.find("#"+a+"-shadow-blur").val(),offsetX:h.find("#"+a+"-shadow-offset-x").val(),offsetY:h.find("#"+a+"-shadow-offset-y").val()});K(this).is(":checked")?m.getActiveObject().shadow=e:m.getActiveObject().shadow=null,m.requestRenderAll()}),h.find("#"+a+"-shadow-color").bind("change",function(){m.getActiveObject().shadow.color=K(this).val(),m.requestRenderAll()}),h.find("#"+a+"-shadow-settings input[type=number]").bind("input paste keyup keydown",function(){var e=K(this).val();K(this).attr("id")==a+"-shadow-blur"?m.getActiveObject().shadow.blur=parseInt(e):K(this).attr("id")==a+"-shadow-offset-x"?m.getActiveObject().shadow.offsetX=parseInt(e):K(this).attr("id")==a+"-shadow-offset-y"&&(m.getActiveObject().shadow.offsetY=parseInt(e)),m.requestRenderAll()})});function V(){var e=m.backgroundImage.getScaledHeight(),a=m.backgroundImage.getScaledWidth();return 0!=s&&180!=s&&-180!=s||(e=m.backgroundImage.getScaledWidth(),a=m.backgroundImage.getScaledHeight()),[e,a]}function J(e){var a=e.element;return K(a).data("icon")?K('<div class="select2-item"><span class="material-icons">'+K(a).data("icon")+"</span>"+e.text+"</div>"):K('<div class="select2-item">'+e.text+"</div>")}K.each(["text","shape","element","customSVG"],function(e,a){h.find("#palleon-"+a+"-gradient").on("change",function(){N(a)}),h.find("#"+a+"-gradient-color-1").on("change",function(){N(a)}),h.find("#"+a+"-gradient-color-2").on("change",function(){N(a)}),h.find("#"+a+"-gradient-color-3").on("change",function(){N(a)}),h.find("#"+a+"-gradient-color-4").on("change",function(){N(a)})}),h.find("#palleon-add-text").on("click",function(){var e=new fabric.Textbox(palleonParams.textbox,{objectType:"textbox",gradientFill:"none",fontSize:d.fontSize,fontFamily:d.fontFamily,fontWeight:d.fontWeight,fontStyle:d.fontStyle,lineHeight:d.lineHeight,fill:d.fill,stroke:d.stroke,strokeWidth:d.strokeWidth,textBackgroundColor:d.textBackgroundColor,textAlign:d.textAlign,width:V()[0]/2,top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"});m.add(e),m.setActiveObject(e),m.fire("palleon:history",{type:"textbox",text:palleonParams.added})}),h.find("#palleon-text-input").bind("input paste",function(){m.getActiveObject().set("text",K(this).val()),h.find("#palleon-layers #"+m.getActiveObject().id+" .layer-name").html(m.getActiveObject().text),m.requestRenderAll()}),h.find("#palleon-text-input").bind("focusout",function(){m.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),h.find("#palleon-font-family").on("change",function(){for(var e,a,t,l,n=K(this).val(),i="yes",o=0;o<I.length;o++)if(I[o][1]==n){i="no";break}"yes"==i?("undefined"!=typeof palleonCustomFonts&&palleonCustomFonts.fonts.includes(n)||WebFont.load({google:{families:[n+":regular,bold",n+":italic,regular,bold"]}}),e=new FontFaceObserver(n,{weight:"normal",style:"normal"}),a=new FontFaceObserver(n,{weight:"bold",style:"normal"}),t=new FontFaceObserver(n,{weight:"normal",style:"italic"}),l=new FontFaceObserver(n,{weight:"bold",style:"italic"}),Promise.all([e.load(null,5e3),a.load(null,5e3),t.load(null,5e3),l.load(null,5e3)]).then(function(){m.getActiveObject().set("fontFamily",n),m.requestRenderAll()}).catch(function(e){console.log(e)})):(m.getActiveObject().set("fontFamily",n),m.requestRenderAll())}),h.find("#palleon-text-format-btns > .palleon-btn").on("click",function(){K(this).hasClass("active")?("format-bold"==K(this).attr("id")&&(m.getActiveObject().set("fontWeight","normal"),K(this).removeClass("active")),"format-italic"==K(this).attr("id")&&(m.getActiveObject().set("fontStyle","normal"),K(this).removeClass("active")),"format-underlined"==K(this).attr("id")&&(m.getActiveObject().set("underline",!1),K(this).removeClass("active"))):("format-bold"==K(this).attr("id")&&m.getActiveObject().set("fontWeight","bold"),"format-italic"==K(this).attr("id")&&m.getActiveObject().set("fontStyle","italic"),"format-underlined"==K(this).attr("id")&&m.getActiveObject().set("underline",!0),"format-align-left"==K(this).attr("id")&&m.getActiveObject().set("textAlign","left"),"format-align-right"==K(this).attr("id")&&m.getActiveObject().set("textAlign","right"),"format-align-center"==K(this).attr("id")&&m.getActiveObject().set("textAlign","center"),"format-align-justify"==K(this).attr("id")&&m.getActiveObject().set("textAlign","justify"),h.find(".format-align").removeClass("active"),K(this).addClass("active")),m.requestRenderAll(),m.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),h.find("#palleon-text-settings input[type=number]").bind("input paste keyup keydown",function(){var e=K(this).val();"palleon-font-size"==K(this).attr("id")?m.getActiveObject().set("fontSize",parseInt(e)):"palleon-outline-size"==K(this).attr("id")?m.getActiveObject().set("strokeWidth",parseInt(e)):"palleon-line-height"==K(this).attr("id")?m.getActiveObject().set("lineHeight",parseFloat(e)):"palleon-letter-spacing"==K(this).attr("id")&&m.getActiveObject().set("charSpacing",parseInt(e)),m.requestRenderAll()}),h.find("#palleon-text-settings input[type=number]").bind("input",function(){window.clearTimeout(w),w=setTimeout(function(){m.fire("palleon:history",{type:"textbox",text:palleonParams.edited})},500)}),h.find("#palleon-text-settings .palleon-colorpicker").bind("change",function(){var e=K(this).val();"palleon-text-color"==K(this).attr("id")?m.getActiveObject().set("fill",e):"palleon-outline-color"==K(this).attr("id")?m.getActiveObject().set("stroke",e):"palleon-text-background"==K(this).attr("id")&&m.getActiveObject().set("textBackgroundColor",e),m.requestRenderAll(),m.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),h.find("#palleon-text-flip-btns > .palleon-btn").on("click",function(){K(this).hasClass("active")?("text-flip-x"==K(this).attr("id")?m.getActiveObject().set("flipX",!1):"text-flip-y"==K(this).attr("id")&&m.getActiveObject().set("flipY",!1),K(this).removeClass("active")):("text-flip-x"==K(this).attr("id")?m.getActiveObject().set("flipX",!0):"text-flip-y"==K(this).attr("id")&&m.getActiveObject().set("flipY",!0),K(this).addClass("active")),m.requestRenderAll(),m.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),h.find("#palleon-text-settings input[type=range]").bind("input click",function(){var e=K(this).val();"text-skew-x"==K(this).attr("id")?m.getActiveObject().set("skewX",parseInt(e)):"text-skew-y"==K(this).attr("id")?m.getActiveObject().set("skewY",parseInt(e)):"text-rotate"==K(this).attr("id")?m.getActiveObject().set("angle",parseInt(e)):"text-opacity"==K(this).attr("id")&&m.getActiveObject().set("opacity",parseFloat(e)),m.requestRenderAll()}),h.find("#palleon-text-settings input[type=range]").bind("change",function(){m.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),h.find("#palleon-img-upload").on("change",function(e){var a=new FileReader;a.onload=function(e){var a=new Image;R(e.target.result,function(e){a.src=e,a.onload=function(){var e=new fabric.Image(a);e.set({objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"}),m.add(e),e.scaleToWidth(V()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(V()[1]/2),m.setActiveObject(e),m.requestRenderAll()}})},a.readAsDataURL(e.target.files[0]),m.fire("palleon:history",{type:"image",text:palleonParams.added})}),h.find("#img-flip-horizontal").on("click",function(){m.getActiveObject().toggle("flipX"),m.requestRenderAll(),m.fire("palleon:history",{type:"image",text:palleonParams.edited})}),h.find("#img-flip-vertical").on("click",function(){m.getActiveObject().toggle("flipY"),m.requestRenderAll(),m.fire("palleon:history",{type:"image",text:palleonParams.edited})});h.find("#img-border-radius").on("input",function(){var e,a;m.getActiveObject().set("clipPath",(e=m.getActiveObject(),a=parseInt(K(this).val()),new fabric.Rect({width:e.width,height:e.height,rx:a/e.scaleX,ry:a/e.scaleY,left:-e.width/2,top:-e.height/2}))),m.getActiveObject().set("roundedCorders",parseInt(K(this).val())),m.requestRenderAll()}),h.find("#img-border-radius").bind("change",function(){m.fire("palleon:history",{type:"image",text:palleonParams.edited})}),h.find("#img-border-color").bind("change",function(){m.getActiveObject().set("stroke",K(this).val()),m.requestRenderAll(),m.fire("palleon:history",{type:"image",text:palleonParams.edited})}),h.find("#palleon-image-settings input[type=number]").on("input paste",function(){var e=parseInt(K(this).val());"img-border-width"==K(this).attr("id")&&m.getActiveObject().set("strokeWidth",e),m.requestRenderAll()}),h.find("#palleon-image-settings input[type=number]").bind("input",function(){window.clearTimeout(w),w=setTimeout(function(){m.fire("palleon:history",{type:"image",text:palleonParams.edited})},500)}),h.find("#palleon-image-settings input[type=range]").bind("input click",function(){var e=K(this).val();"img-skew-x"==K(this).attr("id")?m.getActiveObject().set("skewX",parseInt(e)):"img-skew-y"==K(this).attr("id")?m.getActiveObject().set("skewY",parseInt(e)):"img-rotate"==K(this).attr("id")?m.getActiveObject().set("angle",parseInt(e)):"img-opacity"==K(this).attr("id")&&m.getActiveObject().set("opacity",parseFloat(e)),m.requestRenderAll()}),h.find("#palleon-image-settings input[type=range]").bind("change",function(){m.fire("palleon:history",{type:"image",text:palleonParams.edited})}),h.find("#palleon-shape-select").on("change",function(){var e=K(this).val();"none"==e||"custom"==e?h.find("#palleon-shape-add").prop("disabled",!0):h.find("#palleon-shape-add").prop("disabled",!1)}),h.find("#palleon-shape-add").on("click",function(){var e=h.find("#palleon-shape-select").val(),a="",t="";"circle"==e?(a=new fabric.Circle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"circle",width:100,height:100,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"ellipse"==e?a=new fabric.Ellipse({rx:75,ry:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"ellipse",width:100,height:100,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"}):"square"==e?(a=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"square",width:100,height:100,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"rectangle"==e?a=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"rectangle",width:200,height:150,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"}):"triangle"==e?a=new fabric.Triangle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"triangle",width:100,height:100,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"}):"trapezoid"==e?(t=[{x:-100,y:-50},{x:100,y:-50},{x:150,y:50},{x:-150,y:50}],a=new fabric.Polygon(t,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"trapezoid",width:100,height:100,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"})):"emerald"==e?(t=[{x:850,y:75},{x:958,y:137.5},{x:958,y:262.5},{x:850,y:325},{x:742,y:262.5},{x:742,y:137.5}],a=new fabric.Polygon(t,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"emerald",width:100,height:100,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"})):"star"==e&&(t=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}],a=new fabric.Polygon(t,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"star",width:100,height:100,gradientFill:"none",top:V()[1]/2,left:V()[0]/2,originX:"center",originY:"center"})),m.add(a),a.scaleToWidth(V()[0]/6),a.isPartiallyOnScreen()&&a.scaleToHeight(V()[1]/6),m.setActiveObject(a),m.requestRenderAll(),m.fire("palleon:history",{type:e,text:palleonParams.added})}),h.find("#palleon-shape-settings .palleon-colorpicker").bind("change",function(){var e=K(this).val();"palleon-shape-color"==K(this).attr("id")?m.getActiveObject().set("fill",e):"shape-outline-color"==K(this).attr("id")&&m.getActiveObject().set("stroke",e),m.requestRenderAll(),m.fire("palleon:history",{type:m.getActiveObject().objectType,text:palleonParams.edited})}),h.find("#palleon-shape-settings input[type=range]").bind("input click",function(){var e=K(this).val();"shape-skew-x"==K(this).attr("id")?m.getActiveObject().set("skewX",parseInt(e)):"shape-skew-y"==K(this).attr("id")?m.getActiveObject().set("skewY",parseInt(e)):"shape-rotate"==K(this).attr("id")?m.getActiveObject().set("angle",parseInt(e)):"shape-opacity"==K(this).attr("id")&&m.getActiveObject().set("opacity",parseFloat(e)),m.requestRenderAll()}),h.find("#palleon-shape-settings input[type=range]").bind("change",function(){m.fire("palleon:history",{type:m.getActiveObject().objectType,text:palleonParams.edited})}),h.find("#palleon-shape-settings input[type=number]").bind("input paste",function(){var e=parseInt(K(this).val());"shape-outline-width"==K(this).attr("id")?m.getActiveObject().set("strokeWidth",e):"shape-custom-width"==K(this).attr("id")?(m.getActiveObject().set("width",e),m.getActiveObject().set("scaleX",1)):"shape-custom-height"==K(this).attr("id")&&(m.getActiveObject().set("height",e),m.getActiveObject().set("scaleY",1)),m.requestRenderAll()}),h.find("#palleon-shape-settings input[type=number]").bind("input",function(){window.clearTimeout(w),w=setTimeout(function(){m.fire("palleon:history",{type:m.getActiveObject().objectType,text:palleonParams.edited})},500)});function Z(r){var e=m.getObjects().filter(e=>"frame"==e.objectType);K.each(e,function(e,a){var t=a.angle,l=a.width,n=a.height,i=V()[0],o=V()[1];0!=t&&180!=t&&-180!=t||(i=V()[1],o=V()[0]),"right"==r?0==t?t=90:90==t?t=180:180==t?t=270:270==t||-90==t?t=0:-180==t?t=-90:-270==t&&(t=-180):"left"==r&&(0==t?t=-90:-90==t?t=-180:-180==t?t=-270:-270==t||90==t?t=0:180==t?t=90:270==t&&(t=180)),a.set("left",V()[0]/2),a.set("top",V()[1]/2),a.set("scaleX",i/l),a.set("scaleY",o/n),a.set("angle",t)}),m.requestRenderAll(),m.fire("palleon:history",{type:"frame",text:palleonParams.edited})}h.find("#palleon-frame-search").on("keyup input",function(){h.find("#palleon-noframes").hide();var e=K(this).val().toLowerCase().replace(/\s/g," ");""==e||e.length<1?(h.find("#palleon-frames-wrap li").show(),h.find("#palleon-frame-search-icon").html("search"),h.find("#palleon-frame-search-icon").removeClass("cancel")):(h.find("#palleon-frame-search-icon").html("clear"),h.find("#palleon-frame-search-icon").addClass("cancel"),e=e,h.find("#palleon-frames-wrap li").hide().filter('[data-keyword*="'+e+'"]').show(),0===h.find("#palleon-frames-wrap li:visible").length&&h.find("#palleon-noframes").show())}),h.find("#palleon-frame-search-icon").on("click",function(){K(this).hasClass("cancel")&&(K(this).removeClass("cancel"),K(this).html("search"),h.find("#palleon-frame-search").val(""),h.find("#palleon-frames-wrap li").show(),h.find("#palleon-noframes").hide())}),h.find(".palleon-frames-grid").on("click",".palleon-frame img",function(){h.find("#palleon-canvas-loader").css("display","flex");var e=K(this).parent().parent(),a=e.data("elsource");h.find(".palleon-frames-grid .palleon-frame").removeClass("active"),e.addClass("active"),fabric.loadSVGFromURL(a,function(e,a){var t=fabric.util.groupSVGElements(e,a),e=t.width,a=t.height;t.set("originX","center"),t.set("originY","center"),t.set("left",V()[0]/2),t.set("top",V()[1]/2),t.set("scaleX",(V()[0]+2)/e),t.set("scaleY",(V()[1]+2)/a),t.set("objectType","frame"),m.add(t),m.setActiveObject(t),m.requestRenderAll(),h.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),m.fire("palleon:history",{type:"frame",text:palleonParams.added})}),h.find("#palleon-frame-color").bind("change",function(){var l=K(this).val(),e=m.getObjects().filter(e=>"frame"==e.objectType);K.each(e,function(e,a){if(""!=a.fill&&a.set("fill",l),a._objects)for(var t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set({fill:l})}),m.requestRenderAll(),m.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),h.find("#palleon-rotate-right-frame").on("click",function(){Z("right")}),h.find("#palleon-rotate-left-frame").on("click",function(){Z("left")}),h.find("#palleon-flip-horizontal-frame").on("click",function(){var e=m.getObjects().filter(e=>"frame"==e.objectType);K.each(e,function(e,a){a.toggle("flipX")}),m.requestRenderAll(),m.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),h.find("#palleon-flip-vertical-frame").on("click",function(){var e=m.getObjects().filter(e=>"frame"==e.objectType);K.each(e,function(e,a){a.toggle("flipY")}),m.requestRenderAll(),m.fire("palleon:history",{type:"frame",text:palleonParams.edited})});h.find("#palleon-element-search").on("keyup input",function(){h.find("#palleon-noelements").hide();var e=K(this).val().toLowerCase().replace(/\s/g," ");""==e||e.length<1?(h.find("#palleon-elements-wrap li").show(),h.find("#palleon-element-search-icon").html("search"),h.find("#palleon-element-search-icon").removeClass("cancel")):(h.find("#palleon-element-search-icon").html("clear"),h.find("#palleon-element-search-icon").addClass("cancel"),e=e,h.find("#palleon-elements-wrap li").hide().filter('[data-keyword*="'+e+'"]').show(),0===h.find("#palleon-elements-wrap li:visible").length&&h.find("#palleon-noelements").show())}),h.find("#palleon-element-search-icon").on("click",function(){K(this).hasClass("cancel")&&(K(this).removeClass("cancel"),K(this).html("search"),h.find("#palleon-element-search").val(""),h.find("#palleon-elements-wrap li").show(),h.find("#palleon-noelements").hide())}),h.find(".palleon-elements-grid").on("click",".palleon-element > *:first-child",function(){var e,a=K(this).parent(),t=a.data("elsource");"palleon-icons-grid"==a.parent().attr("id")&&(e=h.find("#palleon-icon-style").val(),t=a.data("elsource")+"/"+e+"/24px.svg",console.log(t));var l=a.data("loader");"yes"==l&&h.find("#palleon-canvas-loader").css("display","flex"),h.find(".palleon-elements-grid .palleon-element").removeClass("active"),a.addClass("active"),fabric.loadSVGFromURL(t,function(e,a){a=fabric.util.groupSVGElements(e,a);a.set("originX","center"),a.set("originY","center"),a.set("left",V()[0]/2),a.set("top",V()[1]/2),a.set("objectType","element"),a.set("gradientFill","none"),m.add(a),a.scaleToWidth(V()[0]/8),a.isPartiallyOnScreen()&&a.scaleToHeight(V()[1]/8),m.setActiveObject(a),m.requestRenderAll(),"yes"==l&&h.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),m.fire("palleon:history",{type:"element",text:palleonParams.added})}),h.find("#palleon-element-upload").on("change",function(e){var a,t=new FileReader;t.onload=function(e){a=t.result,fabric.loadSVGFromURL(a,function(e,a){a=fabric.util.groupSVGElements(e,a);a.set("originX","center"),a.set("originY","center"),a.set("left",V()[0]/2),a.set("top",V()[1]/2),a.set("objectType","customSVG"),a.scaleToWidth(V()[0]/2),a.scaleToHeight(V()[1]/2),m.add(a),m.setActiveObject(a),m.requestRenderAll()},function(){},{crossOrigin:"anonymous"})},t.readAsDataURL(this.files[0]),m.fire("palleon:history",{type:"element",text:palleonParams.added})}),h.find("#palleon-element-color").bind("change",function(){var e=K(this).val(),a=m.getActiveObject();if(""!=a.fill&&a.set("fill",e),a._objects)for(var t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set({fill:e});m.requestRenderAll(),m.fire("palleon:history",{type:"element",text:palleonParams.edited})}),h.find("#element-flip-horizontal").on("click",function(){m.getActiveObject().toggle("flipX"),m.requestRenderAll(),m.fire("palleon:history",{type:"element",text:palleonParams.edited})}),h.find("#element-flip-vertical").on("click",function(){m.getActiveObject().toggle("flipY"),m.requestRenderAll(),m.fire("palleon:history",{type:"element",text:palleonParams.edited})}),h.find("#palleon-custom-element-options input[type=range]").bind("input click",function(){var e=K(this).val();"element-skew-x"==K(this).attr("id")?m.getActiveObject().set("skewX",parseInt(e)):"element-skew-y"==K(this).attr("id")?m.getActiveObject().set("skewY",parseInt(e)):"element-rotate"==K(this).attr("id")?m.getActiveObject().set("angle",parseInt(e)):"element-opacity"==K(this).attr("id")&&m.getActiveObject().set("opacity",parseFloat(e)),m.requestRenderAll()}),h.find("#palleon-custom-element-options input[type=range]").bind("change",function(){m.fire("palleon:history",{type:"element",text:palleonParams.edited})});function $(e,a){K("#tm-cursor-1").remove(),h.find("#palleon-canvas-wrap").tmpointer({id:1,native_cursor:"enable",cursorSize:e,cursorColor:a})}h.find("#palleon-icon-search").on("keyup input",function(){h.find("#palleon-noicons").hide();var e=K(this).val().toLowerCase().replace(/\s/g," ");""==e||e.length<1?(h.find("#palleon-icons-grid .palleon-element").css("display","flex"),h.find("#palleon-icon-search-icon").html("search"),h.find("#palleon-icon-search-icon").removeClass("cancel")):(h.find("#palleon-icon-search-icon").html("clear"),h.find("#palleon-icon-search-icon").addClass("cancel"),e=e,h.find("#palleon-icons-grid .palleon-element").css("display","none").filter('[title*="'+e+'"]').css("display","flex"),0===h.find("#palleon-icons-grid .palleon-element:visible").length&&h.find("#palleon-noicons").show())}),h.find("#palleon-icon-search-icon").on("click",function(){K(this).hasClass("cancel")&&(K(this).removeClass("cancel"),K(this).html("search"),h.find("#palleon-icon-search").val(""),h.find("#palleon-icons-grid .palleon-element").css("display","flex"),h.find("#palleon-noicons").hide())}),h.find("#palleon-draw-btn").on("click",function(){K(this).hasClass("active")?(h.find("#palleon-draw-undo").prop("disabled",!0),K("#tm-cursor-1").remove(),h.find("#palleon-draw-settings").hide(),h.find("#palleon-icon-menu").css("pointer-events","auto"),K(this).removeClass("active"),m.isDrawingMode=!1,K(this).html('<span class="material-icons">edit</span>Start Drawing')):(h.find("#palleon-draw-undo").prop("disabled",!1),h.find("#palleon-draw-settings").show(),h.find("#palleon-icon-menu").css("pointer-events","none"),K(this).addClass("active"),h.find("#palleon-brush-select").trigger("change"),m.isDrawingMode=!0,K(this).html('<span class="material-icons">close</span>Stop Drawing'))}),h.find("#palleon-brush-select").on("change",function(){var e,a,t,l,n=K(this).val();"pencil"==n?(e=new fabric.PencilBrush(m),m.freeDrawingBrush=e):"circle"==n?(a=new fabric.CircleBrush(m),m.freeDrawingBrush=a):"spray"==n?(a=new fabric.SprayBrush(m),m.freeDrawingBrush=a):"hline"==n?(t=new fabric.PatternBrush(m),(m.freeDrawingBrush=t).getPatternSrc=function(){var e=parseInt(h.find("#brush-pattern-width").val()),a=e/2,t=fabric.document.createElement("canvas");t.width=t.height=e;var l=t.getContext("2d");return l.strokeStyle=h.find("#brush-color").val(),l.lineWidth=a,l.beginPath(),l.moveTo(a,0),l.lineTo(a,e),l.closePath(),l.stroke(),t}):"vline"==n?(t=new fabric.PatternBrush(m),(m.freeDrawingBrush=t).getPatternSrc=function(){var e=parseInt(h.find("#brush-pattern-width").val()),a=e/2,t=fabric.document.createElement("canvas");t.width=t.height=e;var l=t.getContext("2d");return l.strokeStyle=h.find("#brush-color").val(),l.lineWidth=a,l.beginPath(),l.moveTo(0,a),l.lineTo(e,a),l.closePath(),l.stroke(),t}):"square"==n?(l=new fabric.PatternBrush(m),(m.freeDrawingBrush=l).getPatternSrc=function(){var e=parseInt(h.find("#brush-pattern-width").val()),a=parseInt(h.find("#brush-pattern-distance").val()),t=fabric.document.createElement("canvas");t.width=t.height=e+a;a=t.getContext("2d");return a.fillStyle=h.find("#brush-color").val(),a.fillRect(0,0,e,e),t}):"erase"==n&&(l=new fabric.EraserBrush(m),m.freeDrawingBrush=l),(v=m.freeDrawingBrush).getPatternSrc&&(v.source=v.getPatternSrc.call(v)),v.width=parseInt(h.find("#brush-width").val()),"erase"==n?(h.find("#not-erase-brush").hide(),v.shadow=null,v.color="#E91E63"):(m.freeDrawingBrush.inverted=!1,h.find("#palleon-draw-undo").removeClass("active"),h.find("#not-erase-brush").show(),v.color=h.find("#brush-color").val()),h.find("#palleon-brush-shadow").is(":checked")?v.shadow=y:v.shadow=null,$(v.width*m.getZoom(),v.color),"hline"==n||"vline"==n||"square"==n?h.find("#palleon-brush-pattern-width").css("display","flex"):h.find("#palleon-brush-pattern-width").css("display","none"),"square"==n?h.find("#palleon-brush-pattern-distance").css("display","flex"):h.find("#palleon-brush-pattern-distance").css("display","none")}),h.find("#palleon-brush-shadow").on("change",function(){y=new fabric.Shadow({color:h.find("#brush-shadow-color").val(),blur:h.find("#brush-shadow-width").val(),offsetX:h.find("#brush-shadow-shadow-offset-x").val(),offsetY:h.find("#brush-shadow-shadow-offset-y").val()}),K(this).is(":checked")?v.shadow=y:v.shadow=null}),h.find("#palleon-draw-settings input[type=number]").bind("input paste keyup keydown",function(){"brush-width"==K(this).attr("id")?(v.width=parseInt(K(this).val()),$(v.width*m.getZoom(),v.color)):"brush-shadow-shadow-offset-x"==K(this).attr("id")?y.offsetX=parseInt(K(this).val()):"brush-shadow-shadow-offset-y"==K(this).attr("id")?y.offsetY=parseInt(K(this).val()):"brush-shadow-width"==K(this).attr("id")?y.blur=parseInt(K(this).val()):"brush-pattern-width"!=K(this).attr("id")&&"brush-pattern-distance"!=K(this).attr("id")||h.find("#palleon-brush-select").trigger("change")}),h.find("#palleon-draw-settings .palleon-colorpicker").bind("change",function(){"brush-color"==K(this).attr("id")?(v.color=K(this).val(),$(v.width*m.getZoom(),v.color),h.find("#palleon-brush-select").trigger("change")):"brush-shadow-color"==K(this).attr("id")&&(y.color=K(this).val())}),h.find("#palleon-draw-undo").on("click",function(){var e;"erase"==h.find("#palleon-brush-select").val()?m.backgroundImage&&(K(this).hasClass("active")?(K(this).removeClass("active"),m.freeDrawingBrush.inverted=!1):(K(this).addClass("active"),m.freeDrawingBrush.inverted=!0)):(e=m.getObjects().filter(e=>"drawing"==e.objectType).slice(-1)[0],m.remove(e),m.requestRenderAll())}),document.onkeydown=function(e){switch(e.keyCode){case 38:m.getActiveObject()&&(--m.getActiveObject().top,m.requestRenderAll());break;case 40:m.getActiveObject()&&(m.getActiveObject().top+=1,m.requestRenderAll());break;case 37:m.getActiveObject()&&(--m.getActiveObject().left,m.requestRenderAll());break;case 39:m.getActiveObject()&&(m.getActiveObject().left+=1,m.requestRenderAll())}},h.find("#custom-theme").on("change",function(){var e=K(this).val(),e=d.baseURL+"css/"+e+".css";K("#palleon-theme-link").attr("href",e)}),h.find("#custom-font-size").on("input",function(){K("html").css("font-size",K(this).val()+"px")}),h.find("#custom-background").on("change",function(){var e=K(this).val();""!=e&&h.find("#palleon-content").css("background-color",e)}),h.find("#custom-image-background").on("change",function(){var e=K(this).val();h.find("#palleon-canvas-color").spectrum("set",e),m.backgroundColor=""==e?"transparent":e,m.requestRenderAll()}),K(window).on("resize",function(){W()}),d.customFunctions.call(this,h,m,e)}}(jQuery);